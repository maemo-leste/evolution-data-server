<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>Evolution-Data-Server Reference Manual: Contacts Browser Example</title>
<meta name="generator" content="DocBook XSL Stylesheets V1.78.1">
<link rel="home" href="index.html" title="Evolution-Data-Server Reference Manual">
<link rel="up" href="examples.html" title="Part V. Examples">
<link rel="prev" href="examples.html" title="Part V. Examples">
<link rel="next" href="unit-testing.html" title="Part VI. Unit Testing">
<meta name="generator" content="GTK-Doc V1.21 (XML mode)">
<link rel="stylesheet" href="style.css" type="text/css">
</head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
<table class="navigation" id="top" width="100%" summary="Navigation header" cellpadding="2" cellspacing="5"><tr valign="middle">
<td width="100%" align="left" class="shortcuts"></td>
<td><a accesskey="h" href="index.html"><img src="home.png" width="16" height="16" border="0" alt="Home"></a></td>
<td><a accesskey="u" href="examples.html"><img src="up.png" width="16" height="16" border="0" alt="Up"></a></td>
<td><a accesskey="p" href="examples.html"><img src="left.png" width="16" height="16" border="0" alt="Prev"></a></td>
<td><a accesskey="n" href="unit-testing.html"><img src="right.png" width="16" height="16" border="0" alt="Next"></a></td>
</tr></table>
<div class="refentry">
<a name="eds-cursor-example"></a><div class="titlepage"></div>
<div class="refnamediv"><table width="100%"><tr>
<td valign="top">
<h2><span class="refentrytitle">Contacts Browser Example</span></h2>
<p>Contacts Browser Example — 
      Explanation of how to create a scrolling window listing contacts in
      alphabetical order.
    </p>
</td>
<td class="gallery_image" valign="top" align="right"></td>
</tr></table></div>
<div class="refsect1">
<a name="id-1.6.2.3"></a><h2>Introduction</h2>
<p>
      This is a fully functional reference application for implementing scrolling contact
      browsers using the <a class="link" href="eds-EBookClientCursor.html#EBookClientCursor" title="struct EBookClientCursor"><span class="type">EBookClientCursor</span></a>. With the cursor, the following features are
      possible.
    </p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
<p>Display contacts in a configurable sort order</p>
<p>
	  Sort by any <a class="link" href="eds-EContact.html#EContactField" title="enum EContactField"><span class="type">EContactField</span></a> which conforms to <a href="https://developer.gnome.org/gobject/unstable/gobject-Type-Information.html#G-TYPE-STRING:CAPS"><span class="type">G_TYPE_STRING</span></a>, this can be checked
	  with <a class="link" href="eds-EContact.html#e-contact-field-type" title="e_contact_field_type ()"><code class="function">e_contact_field_type()</code></a>
	</p>
</li>
<li class="listitem">
<p>Minimal memory constraints</p>
<p>
	  Only load into memory the contacts which are currently visible in the list
	</p>
</li>
<li class="listitem">
<p>Filter search results on the fly</p>
<p>
	  Set new search expressions generated with <a class="link" href="eds-EBookQuery.html#EBookQuery" title="EBookQuery"><span class="type">EBookQuery</span></a> on the fly. Refresh
	  the contact list at the current position without losing the current cursor
	  position.
	</p>
</li>
<li class="listitem">
<p>Display the the user's alphabet</p>
<p>
	  Using interesting features from ICU libraries allow us to display
	  the user's alphabet, and implement features such as jumping to
	  a given letter in the user's alphabet.
	</p>
</li>
</ul></div>
<p>
      The actual example code is built into the 'example' subdirectory of the Evolution Data Server
      sources. In order to run the example, just launch the program and give it a path to a directory
      full of vcards, bearing the .vcf filename extention.
    </p>
</div>
<div class="refsect1">
<a name="id-1.6.2.4"></a><h2>Contact Browser</h2>
<p>
      Below is an example of the contact browser code itself, the example program is
      broken down into a couple of object classes which are also listed below.
    </p>
<div class="informalexample">
  <table class="listing_frame" border="0" cellpadding="0" cellspacing="0">
    <tbody>
      <tr>
        <td class="listing_lines" align="right"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345
346
347
348
349
350
351
352
353
354
355
356
357
358
359
360
361
362
363
364
365
366
367
368
369
370
371
372
373
374
375
376
377
378
379
380
381
382
383
384
385
386
387
388
389
390
391
392
393
394
395
396
397
398
399
400
401
402
403
404
405
406
407
408
409
410
411
412
413
414
415
416
417
418
419
420
421
422
423
424
425
426
427
428
429
430
431
432
433
434
435
436
437
438
439
440
441
442
443
444
445
446
447
448
449
450
451
452
453
454
455
456
457
458
459
460
461
462
463
464
465
466
467
468
469
470
471
472
473
474
475
476
477
478
479
480
481
482
483
484
485
486
487
488
489
490
491
492
493
494
495
496
497
498
499
500
501
502
503
504
505
506
507
508
509
510
511
512
513
514
515
516
517
518
519
520
521
522
523
524
525
526
527
528
529
530
531
532
533
534
535
536
537
538
539
540
541
542
543
544
545
546
547
548
549
550
551
552
553
554
555
556
557
558
559
560
561
562
563
564
565
566
567
568
569
570
571
572
573
574
575
576
577
578
579
580
581
582
583
584
585
586
587
588
589
590
591
592
593
594
595
596
597
598
599
600
601
602
603
604
605
606
607
608
609
610
611
612
613
614
615
616
617
618
619
620
621
622
623
624
625
626
627
628
629
630
631
632
633
634
635
636
637
638
639
640
641
642
643
644
645
646
647
648
649
650
651
652
653
654
655
656
657
658
659
660
661
662
663
664
665
666
667
668
669
670
671
672
673
674
675
676
677
678
679
680
681
682
683
684
685
686
687
688
689
690
691
692
693
694
695
696
697
698</pre></td>
        <td class="listing_code"><pre class="programlisting"><span class="comment">/* -*- Mode: C; tab-width: 8; indent-tabs-mode: t; c-basic-offset: 8 -*- */</span>
<span class="comment">/*</span>
<span class="comment"> * Copyright (C) 2013 Intel Corporation</span>
<span class="comment"> *</span>
<span class="comment"> * This library is free software you can redistribute it and/or modify it</span>
<span class="comment"> * under the terms of the GNU Lesser General Public License as published by</span>
<span class="comment"> * the Free Software Foundation.</span>
<span class="comment"> *</span>
<span class="comment"> * This library is distributed in the hope that it will be useful, but</span>
<span class="comment"> * WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY</span>
<span class="comment"> * or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License</span>
<span class="comment"> * for more details.</span>
<span class="comment"> *</span>
<span class="comment"> * You should have received a copy of the GNU Lesser General Public License</span>
<span class="comment"> * along with this library; if not, see &lt;http://www.gnu.org/licenses/&gt;.</span>
<span class="comment"> *</span>
<span class="comment"> * Author: Tristan Van Berkom &lt;tristanvb&#64;openismus.com&gt;</span>
<span class="comment"> */</span>

<span class="gtkdoc ppc">#include &lt;libebook/libebook.h&gt;</span>

<span class="gtkdoc ppc">#include</span> <span class="gtkdoc pps">&quot;cursor-example.h&quot;</span><span class="gtkdoc ppc"></span>
<span class="gtkdoc ppc">#include</span> <span class="gtkdoc pps">&quot;cursor-navigator.h&quot;</span><span class="gtkdoc ppc"></span>
<span class="gtkdoc ppc">#include</span> <span class="gtkdoc pps">&quot;cursor-search.h&quot;</span><span class="gtkdoc ppc"></span>
<span class="gtkdoc ppc">#include</span> <span class="gtkdoc pps">&quot;cursor-slot.h&quot;</span><span class="gtkdoc ppc"></span>
<span class="gtkdoc ppc">#include</span> <span class="gtkdoc pps">&quot;cursor-data.h&quot;</span><span class="gtkdoc ppc"></span>
<span class="gtkdoc ppc">#include</span> <span class="gtkdoc pps">&quot;cursor-slot.h&quot;</span><span class="gtkdoc ppc"></span>

<span class="gtkdoc ppc">#define N_SLOTS         10</span>

<span class="gtkdoc ppc">#define INITIAL_TIMEOUT 600</span>
<span class="gtkdoc ppc">#define TICK_TIMEOUT    100</span>

<span class="gtkdoc ppc">#define d(x)</span>

<span class="gtkdoc kwc">typedef</span> <span class="gtkdoc kwb">enum</span> _TimeoutActivity TimeoutActivity<span class="gtkdoc opt">;</span>

<span class="comment">/* GObjectClass */</span>
<span class="gtkdoc kwb">static void</span>            <span class="function">cursor_example_dispose</span>                 <span class="gtkdoc opt">(</span>GObject            <span class="gtkdoc opt">*</span>object<span class="gtkdoc opt">);</span>

<span class="comment">/* UI Callbacks */</span>
<span class="gtkdoc kwb">static</span> gboolean        <span class="function">cursor_example_up_button_press</span>         <span class="gtkdoc opt">(</span>CursorExample      <span class="gtkdoc opt">*</span>example<span class="gtkdoc opt">,</span>
						       GdkEvent           <span class="gtkdoc opt">*</span>event<span class="gtkdoc opt">,</span>
						       GtkButton          <span class="gtkdoc opt">*</span>button<span class="gtkdoc opt">);</span>
<span class="gtkdoc kwb">static</span> gboolean        <span class="function">cursor_example_up_button_release</span>       <span class="gtkdoc opt">(</span>CursorExample      <span class="gtkdoc opt">*</span>example<span class="gtkdoc opt">,</span>
						       GdkEvent           <span class="gtkdoc opt">*</span>event<span class="gtkdoc opt">,</span>
						       GtkButton          <span class="gtkdoc opt">*</span>button<span class="gtkdoc opt">);</span>
<span class="gtkdoc kwb">static</span> gboolean        <span class="function">cursor_example_down_button_press</span>       <span class="gtkdoc opt">(</span>CursorExample      <span class="gtkdoc opt">*</span>example<span class="gtkdoc opt">,</span>
						       GdkEvent           <span class="gtkdoc opt">*</span>event<span class="gtkdoc opt">,</span>
						       GtkButton          <span class="gtkdoc opt">*</span>button<span class="gtkdoc opt">);</span>
<span class="gtkdoc kwb">static</span> gboolean        <span class="function">cursor_example_down_button_release</span>     <span class="gtkdoc opt">(</span>CursorExample      <span class="gtkdoc opt">*</span>example<span class="gtkdoc opt">,</span>
						       GdkEvent           <span class="gtkdoc opt">*</span>event<span class="gtkdoc opt">,</span>
						       GtkButton          <span class="gtkdoc opt">*</span>button<span class="gtkdoc opt">);</span>
<span class="gtkdoc kwb">static void</span>            <span class="function">cursor_example_navigator_changed</span>       <span class="gtkdoc opt">(</span>CursorExample      <span class="gtkdoc opt">*</span>example<span class="gtkdoc opt">,</span>
						       CursorNavigator    <span class="gtkdoc opt">*</span>navigator<span class="gtkdoc opt">);</span>
<span class="gtkdoc kwb">static void</span>            <span class="function">cursor_example_sexp_changed</span>            <span class="gtkdoc opt">(</span>CursorExample      <span class="gtkdoc opt">*</span>example<span class="gtkdoc opt">,</span>
						       GParamSpec         <span class="gtkdoc opt">*</span>pspec<span class="gtkdoc opt">,</span>
						       CursorSearch       <span class="gtkdoc opt">*</span>search<span class="gtkdoc opt">);</span>

<span class="comment">/* EDS Callbacks */</span>
<span class="gtkdoc kwb">static void</span>            <span class="function">cursor_example_refresh</span>                 <span class="gtkdoc opt">(</span>EBookClientCursor  <span class="gtkdoc opt">*</span>cursor<span class="gtkdoc opt">,</span>
						       CursorExample      <span class="gtkdoc opt">*</span>example<span class="gtkdoc opt">);</span>
<span class="gtkdoc kwb">static void</span>            <span class="function">cursor_example_alphabet_changed</span>        <span class="gtkdoc opt">(</span>EBookClientCursor  <span class="gtkdoc opt">*</span>cursor<span class="gtkdoc opt">,</span>
						       GParamSpec         <span class="gtkdoc opt">*</span>pspec<span class="gtkdoc opt">,</span>
						       CursorExample      <span class="gtkdoc opt">*</span>example<span class="gtkdoc opt">);</span>
<span class="gtkdoc kwb">static void</span>            <span class="function">cursor_example_status_changed</span>          <span class="gtkdoc opt">(</span>EBookClientCursor  <span class="gtkdoc opt">*</span>cursor<span class="gtkdoc opt">,</span>
						       GParamSpec         <span class="gtkdoc opt">*</span>spec<span class="gtkdoc opt">,</span>
						       CursorExample      <span class="gtkdoc opt">*</span>example<span class="gtkdoc opt">);</span>

<span class="comment">/* Utilities */</span>
<span class="gtkdoc kwb">static void</span>            <span class="function">cursor_example_load_alphabet</span>           <span class="gtkdoc opt">(</span>CursorExample      <span class="gtkdoc opt">*</span>example<span class="gtkdoc opt">);</span>
<span class="gtkdoc kwb">static</span> gboolean        <span class="function">cursor_example_move_cursor</span>             <span class="gtkdoc opt">(</span>CursorExample      <span class="gtkdoc opt">*</span>example<span class="gtkdoc opt">,</span>
						       EBookCursorOrigin   origin<span class="gtkdoc opt">,</span>
						       gint                count<span class="gtkdoc opt">);</span>
<span class="gtkdoc kwb">static</span> gboolean        <span class="function">cursor_example_load_page</span>               <span class="gtkdoc opt">(</span>CursorExample      <span class="gtkdoc opt">*</span>example<span class="gtkdoc opt">,</span>
						       gboolean           <span class="gtkdoc opt">*</span>full_results<span class="gtkdoc opt">);</span>
<span class="gtkdoc kwb">static void</span>            <span class="function">cursor_example_update_status</span>           <span class="gtkdoc opt">(</span>CursorExample      <span class="gtkdoc opt">*</span>example<span class="gtkdoc opt">);</span>
<span class="gtkdoc kwb">static void</span>            <span class="function">cursor_example_update_current_index</span>    <span class="gtkdoc opt">(</span>CursorExample      <span class="gtkdoc opt">*</span>example<span class="gtkdoc opt">,</span>
						       EContact           <span class="gtkdoc opt">*</span>contact<span class="gtkdoc opt">);</span>
<span class="gtkdoc kwb">static void</span>            <span class="function">cursor_example_ensure_timeout</span>          <span class="gtkdoc opt">(</span>CursorExample      <span class="gtkdoc opt">*</span>example<span class="gtkdoc opt">,</span>
						       TimeoutActivity     activity<span class="gtkdoc opt">);</span>
<span class="gtkdoc kwb">static void</span>            <span class="function">cursor_example_cancel_timeout</span>          <span class="gtkdoc opt">(</span>CursorExample      <span class="gtkdoc opt">*</span>example<span class="gtkdoc opt">);</span>

<span class="gtkdoc kwb">enum</span> _TimeoutActivity <span class="gtkdoc opt">{</span>
TIMEOUT_NONE <span class="gtkdoc opt">=</span> <span class="number">0</span><span class="gtkdoc opt">,</span>
TIMEOUT_UP_INITIAL<span class="gtkdoc opt">,</span>
TIMEOUT_UP_TICK<span class="gtkdoc opt">,</span>
TIMEOUT_DOWN_INITIAL<span class="gtkdoc opt">,</span>
TIMEOUT_DOWN_TICK<span class="gtkdoc opt">,</span>
<span class="gtkdoc opt">};</span>

<span class="gtkdoc kwb">struct</span> _CursorExamplePrivate <span class="gtkdoc opt">{</span>
<span class="comment">/* Screen widgets */</span>
GtkWidget <span class="gtkdoc opt">*</span>browse_up_button<span class="gtkdoc opt">;</span>
GtkWidget <span class="gtkdoc opt">*</span>browse_down_button<span class="gtkdoc opt">;</span>
GtkWidget <span class="gtkdoc opt">*</span>progressbar<span class="gtkdoc opt">;</span>
GtkWidget <span class="gtkdoc opt">*</span>alphabet_label<span class="gtkdoc opt">;</span>
GtkWidget <span class="gtkdoc opt">*</span>slots<span class="gtkdoc opt">[</span>N_SLOTS<span class="gtkdoc opt">];</span>
CursorNavigator <span class="gtkdoc opt">*</span>navigator<span class="gtkdoc opt">;</span>

<span class="comment">/* EDS Resources */</span>
EBookClient          <span class="gtkdoc opt">*</span>client<span class="gtkdoc opt">;</span>
EBookClientCursor    <span class="gtkdoc opt">*</span>cursor<span class="gtkdoc opt">;</span>

<span class="comment">/* Manage the automatic scrolling with button pressed */</span>
guint                 timeout_id<span class="gtkdoc opt">;</span>
TimeoutActivity       activity<span class="gtkdoc opt">;</span>
<span class="gtkdoc opt">};</span>

<span class="function"><a href="https://developer.gnome.org/gobject/unstable/gobject-Type-Information.html#G-DEFINE-TYPE-WITH-PRIVATE:CAPS">G_DEFINE_TYPE_WITH_PRIVATE</a></span> <span class="gtkdoc opt">(</span>CursorExample<span class="gtkdoc opt">,</span> cursor_example<span class="gtkdoc opt">,</span> GTK_TYPE_WINDOW<span class="gtkdoc opt">);</span>

<span class="comment">/************************************************************************</span>
<span class="comment"> *                          GObjectClass                                *</span>
<span class="comment"> ************************************************************************/</span>
<span class="gtkdoc kwb">static void</span>
<span class="function">cursor_example_class_init</span> <span class="gtkdoc opt">(</span>CursorExampleClass <span class="gtkdoc opt">*</span>klass<span class="gtkdoc opt">)</span>
<span class="gtkdoc opt">{</span>
GObjectClass <span class="gtkdoc opt">*</span>object_class<span class="gtkdoc opt">;</span>
GtkWidgetClass <span class="gtkdoc opt">*</span>widget_class<span class="gtkdoc opt">;</span>
gint i<span class="gtkdoc opt">;</span>

object_class <span class="gtkdoc opt">=</span> <span class="function"><a href="https://developer.gnome.org/gobject/unstable/gobject-The-Base-Object-Type.html#G-OBJECT-CLASS:CAPS">G_OBJECT_CLASS</a></span> <span class="gtkdoc opt">(</span>klass<span class="gtkdoc opt">);</span>
object_class<span class="gtkdoc opt">-&gt;</span>dispose <span class="gtkdoc opt">=</span> cursor_example_dispose<span class="gtkdoc opt">;</span>

<span class="comment">/* Bind to template */</span>
widget_class <span class="gtkdoc opt">=</span> <span class="function">GTK_WIDGET_CLASS</span> <span class="gtkdoc opt">(</span>klass<span class="gtkdoc opt">);</span>
<span class="function"><a href="http://developer.gnome.org/gtk2/GtkWidget.html#gtk-widget-class-set-template-from-resource">gtk_widget_class_set_template_from_resource</a></span> <span class="gtkdoc opt">(</span>widget_class<span class="gtkdoc opt">,</span> <span class="string">&quot;/org/gnome/evolution/cursor-example/cursor-example.ui&quot;</span><span class="gtkdoc opt">);</span>
<span class="function"><a href="http://developer.gnome.org/gtk2/GtkWidget.html#gtk-widget-class-bind-template-child-private">gtk_widget_class_bind_template_child_private</a></span> <span class="gtkdoc opt">(</span>widget_class<span class="gtkdoc opt">,</span> CursorExample<span class="gtkdoc opt">,</span> navigator<span class="gtkdoc opt">);</span>
<span class="function"><a href="http://developer.gnome.org/gtk2/GtkWidget.html#gtk-widget-class-bind-template-child-private">gtk_widget_class_bind_template_child_private</a></span> <span class="gtkdoc opt">(</span>widget_class<span class="gtkdoc opt">,</span> CursorExample<span class="gtkdoc opt">,</span> browse_up_button<span class="gtkdoc opt">);</span>
<span class="function"><a href="http://developer.gnome.org/gtk2/GtkWidget.html#gtk-widget-class-bind-template-child-private">gtk_widget_class_bind_template_child_private</a></span> <span class="gtkdoc opt">(</span>widget_class<span class="gtkdoc opt">,</span> CursorExample<span class="gtkdoc opt">,</span> browse_down_button<span class="gtkdoc opt">);</span>
<span class="function"><a href="http://developer.gnome.org/gtk2/GtkWidget.html#gtk-widget-class-bind-template-child-private">gtk_widget_class_bind_template_child_private</a></span> <span class="gtkdoc opt">(</span>widget_class<span class="gtkdoc opt">,</span> CursorExample<span class="gtkdoc opt">,</span> alphabet_label<span class="gtkdoc opt">);</span>
<span class="function"><a href="http://developer.gnome.org/gtk2/GtkWidget.html#gtk-widget-class-bind-template-child-private">gtk_widget_class_bind_template_child_private</a></span> <span class="gtkdoc opt">(</span>widget_class<span class="gtkdoc opt">,</span> CursorExample<span class="gtkdoc opt">,</span> progressbar<span class="gtkdoc opt">);</span>

<span class="keyword">for</span> <span class="gtkdoc opt">(</span>i <span class="gtkdoc opt">=</span> <span class="number">0</span><span class="gtkdoc opt">;</span> i <span class="gtkdoc opt">&lt;</span> N_SLOTS<span class="gtkdoc opt">;</span> i<span class="gtkdoc opt">++) {</span>
	gchar <span class="gtkdoc opt">*</span>name <span class="gtkdoc opt">=</span> <span class="function"><a href="https://developer.gnome.org/glib/unstable/glib-String-Utility-Functions.html#g-strdup-printf">g_strdup_printf</a></span> <span class="gtkdoc opt">(</span><span class="string">&quot;contact_slot_%d&quot;</span><span class="gtkdoc opt">,</span> i <span class="gtkdoc opt">+</span> <span class="number">1</span><span class="gtkdoc opt">);</span>

	<span class="function"><a href="http://developer.gnome.org/gtk2/GtkWidget.html#gtk-widget-class-bind-template-child-full">gtk_widget_class_bind_template_child_full</a></span> <span class="gtkdoc opt">(</span>widget_class<span class="gtkdoc opt">,</span> name<span class="gtkdoc opt">,</span> FALSE<span class="gtkdoc opt">,</span> <span class="number">0</span><span class="gtkdoc opt">);</span>
	<span class="function"><a href="https://developer.gnome.org/glib/unstable/glib-Memory-Allocation.html#g-free">g_free</a></span> <span class="gtkdoc opt">(</span>name<span class="gtkdoc opt">);</span>
<span class="gtkdoc opt">}</span>

<span class="function"><a href="http://developer.gnome.org/gtk2/GtkWidget.html#gtk-widget-class-bind-template-callback">gtk_widget_class_bind_template_callback</a></span> <span class="gtkdoc opt">(</span>widget_class<span class="gtkdoc opt">,</span> cursor_example_navigator_changed<span class="gtkdoc opt">);</span>
<span class="function"><a href="http://developer.gnome.org/gtk2/GtkWidget.html#gtk-widget-class-bind-template-callback">gtk_widget_class_bind_template_callback</a></span> <span class="gtkdoc opt">(</span>widget_class<span class="gtkdoc opt">,</span> cursor_example_up_button_press<span class="gtkdoc opt">);</span>
<span class="function"><a href="http://developer.gnome.org/gtk2/GtkWidget.html#gtk-widget-class-bind-template-callback">gtk_widget_class_bind_template_callback</a></span> <span class="gtkdoc opt">(</span>widget_class<span class="gtkdoc opt">,</span> cursor_example_up_button_release<span class="gtkdoc opt">);</span>
<span class="function"><a href="http://developer.gnome.org/gtk2/GtkWidget.html#gtk-widget-class-bind-template-callback">gtk_widget_class_bind_template_callback</a></span> <span class="gtkdoc opt">(</span>widget_class<span class="gtkdoc opt">,</span> cursor_example_down_button_press<span class="gtkdoc opt">);</span>
<span class="function"><a href="http://developer.gnome.org/gtk2/GtkWidget.html#gtk-widget-class-bind-template-callback">gtk_widget_class_bind_template_callback</a></span> <span class="gtkdoc opt">(</span>widget_class<span class="gtkdoc opt">,</span> cursor_example_down_button_release<span class="gtkdoc opt">);</span>
<span class="function"><a href="http://developer.gnome.org/gtk2/GtkWidget.html#gtk-widget-class-bind-template-callback">gtk_widget_class_bind_template_callback</a></span> <span class="gtkdoc opt">(</span>widget_class<span class="gtkdoc opt">,</span> cursor_example_sexp_changed<span class="gtkdoc opt">);</span>
<span class="gtkdoc opt">}</span>

<span class="gtkdoc kwb">static void</span>
<span class="function">cursor_example_init</span> <span class="gtkdoc opt">(</span>CursorExample <span class="gtkdoc opt">*</span>example<span class="gtkdoc opt">)</span>
<span class="gtkdoc opt">{</span>
CursorExamplePrivate <span class="gtkdoc opt">*</span>priv<span class="gtkdoc opt">;</span>
gint i<span class="gtkdoc opt">;</span>

example<span class="gtkdoc opt">-&gt;</span>priv <span class="gtkdoc opt">=</span> priv <span class="gtkdoc opt">=</span>
	<span class="function">cursor_example_get_instance_private</span> <span class="gtkdoc opt">(</span>example<span class="gtkdoc opt">);</span>

<span class="function"><a href="https://developer.gnome.org/gobject/unstable/gobject-Type-Information.html#g-type-ensure">g_type_ensure</a></span> <span class="gtkdoc opt">(</span>CURSOR_TYPE_NAVIGATOR<span class="gtkdoc opt">);</span>
<span class="function"><a href="https://developer.gnome.org/gobject/unstable/gobject-Type-Information.html#g-type-ensure">g_type_ensure</a></span> <span class="gtkdoc opt">(</span>CURSOR_TYPE_SEARCH<span class="gtkdoc opt">);</span>

<span class="function"><a href="http://developer.gnome.org/gtk2/GtkWidget.html#gtk-widget-init-template">gtk_widget_init_template</a></span> <span class="gtkdoc opt">(</span><span class="function">GTK_WIDGET</span> <span class="gtkdoc opt">(</span>example<span class="gtkdoc opt">));</span>

<span class="keyword">for</span> <span class="gtkdoc opt">(</span>i <span class="gtkdoc opt">=</span> <span class="number">0</span><span class="gtkdoc opt">;</span> i <span class="gtkdoc opt">&lt;</span> N_SLOTS<span class="gtkdoc opt">;</span> i<span class="gtkdoc opt">++) {</span>

	gchar <span class="gtkdoc opt">*</span>name <span class="gtkdoc opt">=</span> <span class="function"><a href="https://developer.gnome.org/glib/unstable/glib-String-Utility-Functions.html#g-strdup-printf">g_strdup_printf</a></span> <span class="gtkdoc opt">(</span><span class="string">&quot;contact_slot_%d&quot;</span><span class="gtkdoc opt">,</span> i <span class="gtkdoc opt">+</span> <span class="number">1</span><span class="gtkdoc opt">);</span>
	priv<span class="gtkdoc opt">-&gt;</span>slots<span class="gtkdoc opt">[</span>i<span class="gtkdoc opt">] = (</span>GtkWidget <span class="gtkdoc opt">*)</span> <span class="function"><a href="http://developer.gnome.org/gtk2/GtkWidget.html#gtk-widget-get-template-child">gtk_widget_get_template_child</a></span> <span class="gtkdoc opt">(</span><span class="function">GTK_WIDGET</span> <span class="gtkdoc opt">(</span>example<span class="gtkdoc opt">),</span>
								     CURSOR_TYPE_EXAMPLE<span class="gtkdoc opt">,</span>
								     name<span class="gtkdoc opt">);</span>
	<span class="function"><a href="https://developer.gnome.org/glib/unstable/glib-Memory-Allocation.html#g-free">g_free</a></span> <span class="gtkdoc opt">(</span>name<span class="gtkdoc opt">);</span>
<span class="gtkdoc opt">}</span>
<span class="gtkdoc opt">}</span>

<span class="gtkdoc kwb">static void</span>
<span class="function">cursor_example_dispose</span> <span class="gtkdoc opt">(</span>GObject <span class="gtkdoc opt">*</span>object<span class="gtkdoc opt">)</span>
<span class="gtkdoc opt">{</span>
CursorExample        <span class="gtkdoc opt">*</span>example <span class="gtkdoc opt">=</span> <span class="function">CURSOR_EXAMPLE</span> <span class="gtkdoc opt">(</span>object<span class="gtkdoc opt">);</span>
CursorExamplePrivate <span class="gtkdoc opt">*</span>priv <span class="gtkdoc opt">=</span> example<span class="gtkdoc opt">-&gt;</span>priv<span class="gtkdoc opt">;</span>

<span class="function">cursor_example_cancel_timeout</span> <span class="gtkdoc opt">(</span>example<span class="gtkdoc opt">);</span>

<span class="keyword">if</span> <span class="gtkdoc opt">(</span>priv<span class="gtkdoc opt">-&gt;</span>client<span class="gtkdoc opt">) {</span>
	<span class="function"><a href="https://developer.gnome.org/gobject/unstable/gobject-The-Base-Object-Type.html#g-object-unref">g_object_unref</a></span> <span class="gtkdoc opt">(</span>priv<span class="gtkdoc opt">-&gt;</span>client<span class="gtkdoc opt">);</span>
	priv<span class="gtkdoc opt">-&gt;</span>client <span class="gtkdoc opt">=</span> NULL<span class="gtkdoc opt">;</span>
<span class="gtkdoc opt">}</span>

<span class="keyword">if</span> <span class="gtkdoc opt">(</span>priv<span class="gtkdoc opt">-&gt;</span>cursor<span class="gtkdoc opt">) {</span>
	<span class="function"><a href="https://developer.gnome.org/gobject/unstable/gobject-The-Base-Object-Type.html#g-object-unref">g_object_unref</a></span> <span class="gtkdoc opt">(</span>priv<span class="gtkdoc opt">-&gt;</span>cursor<span class="gtkdoc opt">);</span>
	priv<span class="gtkdoc opt">-&gt;</span>cursor <span class="gtkdoc opt">=</span> NULL<span class="gtkdoc opt">;</span>
<span class="gtkdoc opt">}</span>

<span class="function"><a href="https://developer.gnome.org/gobject/unstable/gobject-The-Base-Object-Type.html#G-OBJECT-CLASS:CAPS">G_OBJECT_CLASS</a></span> <span class="gtkdoc opt">(</span>cursor_example_parent_class<span class="gtkdoc opt">)-&gt;</span><span class="function">dispose</span> <span class="gtkdoc opt">(</span>object<span class="gtkdoc opt">);</span>
<span class="gtkdoc opt">}</span>

<span class="comment">/************************************************************************</span>
<span class="comment"> *                           UI Callbacks                               *</span>
<span class="comment"> ************************************************************************/</span>
<span class="gtkdoc kwb">static</span> gboolean
<span class="function">cursor_example_up_button_press</span> <span class="gtkdoc opt">(</span>CursorExample <span class="gtkdoc opt">*</span>example<span class="gtkdoc opt">,</span>
                                GdkEvent <span class="gtkdoc opt">*</span>event<span class="gtkdoc opt">,</span>
                                GtkButton <span class="gtkdoc opt">*</span>button<span class="gtkdoc opt">)</span>
<span class="gtkdoc opt">{</span>
<span class="function">d</span> <span class="gtkdoc opt">(</span><span class="function"><a href="https://developer.gnome.org/glib/unstable/glib-Warnings-and-Assertions.html#g-print">g_print</a></span> <span class="gtkdoc opt">(</span><span class="string">&quot;Browse up press</span><span class="gtkdoc esc">\n</span><span class="string">&quot;</span><span class="gtkdoc opt">));</span>

<span class="comment">/* Move the cursor backwards by 1 and then refresh the page */</span>
<span class="keyword">if</span> <span class="gtkdoc opt">(</span><span class="function">cursor_example_move_cursor</span> <span class="gtkdoc opt">(</span>example<span class="gtkdoc opt">,</span> E_BOOK_CURSOR_ORIGIN_CURRENT<span class="gtkdoc opt">,</span> <span class="number">0</span> <span class="gtkdoc opt">-</span> <span class="number">1</span><span class="gtkdoc opt">))</span>
	<span class="function">cursor_example_load_page</span> <span class="gtkdoc opt">(</span>example<span class="gtkdoc opt">,</span> NULL<span class="gtkdoc opt">);</span>

<span class="function">cursor_example_ensure_timeout</span> <span class="gtkdoc opt">(</span>example<span class="gtkdoc opt">,</span> TIMEOUT_UP_INITIAL<span class="gtkdoc opt">);</span>

<span class="keyword">return</span> FALSE<span class="gtkdoc opt">;</span>
<span class="gtkdoc opt">}</span>

<span class="gtkdoc kwb">static</span> gboolean
<span class="function">cursor_example_up_button_release</span> <span class="gtkdoc opt">(</span>CursorExample <span class="gtkdoc opt">*</span>example<span class="gtkdoc opt">,</span>
                                  GdkEvent <span class="gtkdoc opt">*</span>event<span class="gtkdoc opt">,</span>
                                  GtkButton <span class="gtkdoc opt">*</span>button<span class="gtkdoc opt">)</span>
<span class="gtkdoc opt">{</span>
<span class="function">d</span> <span class="gtkdoc opt">(</span><span class="function"><a href="https://developer.gnome.org/glib/unstable/glib-Warnings-and-Assertions.html#g-print">g_print</a></span> <span class="gtkdoc opt">(</span><span class="string">&quot;Browse up release</span><span class="gtkdoc esc">\n</span><span class="string">&quot;</span><span class="gtkdoc opt">));</span>

<span class="function">cursor_example_cancel_timeout</span> <span class="gtkdoc opt">(</span>example<span class="gtkdoc opt">);</span>

<span class="keyword">return</span> FALSE<span class="gtkdoc opt">;</span>
<span class="gtkdoc opt">}</span>

<span class="gtkdoc kwb">static</span> gboolean
<span class="function">cursor_example_down_button_press</span> <span class="gtkdoc opt">(</span>CursorExample <span class="gtkdoc opt">*</span>example<span class="gtkdoc opt">,</span>
                                  GdkEvent <span class="gtkdoc opt">*</span>event<span class="gtkdoc opt">,</span>
                                  GtkButton <span class="gtkdoc opt">*</span>button<span class="gtkdoc opt">)</span>
<span class="gtkdoc opt">{</span>
<span class="function">d</span> <span class="gtkdoc opt">(</span><span class="function"><a href="https://developer.gnome.org/glib/unstable/glib-Warnings-and-Assertions.html#g-print">g_print</a></span> <span class="gtkdoc opt">(</span><span class="string">&quot;Browse down press</span><span class="gtkdoc esc">\n</span><span class="string">&quot;</span><span class="gtkdoc opt">));</span>

<span class="comment">/* Move the cursor forward by 1 and then refresh the page */</span>
<span class="keyword">if</span> <span class="gtkdoc opt">(</span><span class="function">cursor_example_move_cursor</span> <span class="gtkdoc opt">(</span>example<span class="gtkdoc opt">,</span> E_BOOK_CURSOR_ORIGIN_CURRENT<span class="gtkdoc opt">,</span> <span class="number">1</span><span class="gtkdoc opt">))</span>
	<span class="function">cursor_example_load_page</span> <span class="gtkdoc opt">(</span>example<span class="gtkdoc opt">,</span> NULL<span class="gtkdoc opt">);</span>

<span class="function">cursor_example_ensure_timeout</span> <span class="gtkdoc opt">(</span>example<span class="gtkdoc opt">,</span> TIMEOUT_DOWN_INITIAL<span class="gtkdoc opt">);</span>

<span class="keyword">return</span> FALSE<span class="gtkdoc opt">;</span>
<span class="gtkdoc opt">}</span>

<span class="gtkdoc kwb">static</span> gboolean
<span class="function">cursor_example_down_button_release</span> <span class="gtkdoc opt">(</span>CursorExample <span class="gtkdoc opt">*</span>example<span class="gtkdoc opt">,</span>
                                    GdkEvent <span class="gtkdoc opt">*</span>event<span class="gtkdoc opt">,</span>
                                    GtkButton <span class="gtkdoc opt">*</span>button<span class="gtkdoc opt">)</span>
<span class="gtkdoc opt">{</span>
<span class="function">d</span> <span class="gtkdoc opt">(</span><span class="function"><a href="https://developer.gnome.org/glib/unstable/glib-Warnings-and-Assertions.html#g-print">g_print</a></span> <span class="gtkdoc opt">(</span><span class="string">&quot;Browse down released</span><span class="gtkdoc esc">\n</span><span class="string">&quot;</span><span class="gtkdoc opt">));</span>

<span class="function">cursor_example_cancel_timeout</span> <span class="gtkdoc opt">(</span>example<span class="gtkdoc opt">);</span>

<span class="keyword">return</span> FALSE<span class="gtkdoc opt">;</span>
<span class="gtkdoc opt">}</span>

<span class="gtkdoc kwb">static void</span>
<span class="function">cursor_example_navigator_changed</span> <span class="gtkdoc opt">(</span>CursorExample <span class="gtkdoc opt">*</span>example<span class="gtkdoc opt">,</span>
                                  CursorNavigator <span class="gtkdoc opt">*</span>navigator<span class="gtkdoc opt">)</span>
<span class="gtkdoc opt">{</span>
CursorExamplePrivate <span class="gtkdoc opt">*</span>priv <span class="gtkdoc opt">=</span> example<span class="gtkdoc opt">-&gt;</span>priv<span class="gtkdoc opt">;</span>
GError               <span class="gtkdoc opt">*</span>error <span class="gtkdoc opt">=</span> NULL<span class="gtkdoc opt">;</span>
gint                  index<span class="gtkdoc opt">;</span>
gboolean              full_results <span class="gtkdoc opt">=</span> FALSE<span class="gtkdoc opt">;</span>

index <span class="gtkdoc opt">=</span> <span class="function">cursor_navigator_get_index</span> <span class="gtkdoc opt">(</span>priv<span class="gtkdoc opt">-&gt;</span>navigator<span class="gtkdoc opt">);</span>

<span class="function">d</span> <span class="gtkdoc opt">(</span><span class="function"><a href="https://developer.gnome.org/glib/unstable/glib-Warnings-and-Assertions.html#g-print">g_print</a></span> <span class="gtkdoc opt">(</span><span class="string">&quot;Alphabet index changed to: %d</span><span class="gtkdoc esc">\n</span><span class="string">&quot;</span><span class="gtkdoc opt">,</span> index<span class="gtkdoc opt">));</span>

<span class="comment">/* Move to this index */</span>
<span class="keyword">if</span> <span class="gtkdoc opt">(!</span><span class="function"><a href="eds-EBookClientCursor.html#e-book-client-cursor-set-alphabetic-index-sync">e_book_client_cursor_set_alphabetic_index_sync</a></span> <span class="gtkdoc opt">(</span>priv<span class="gtkdoc opt">-&gt;</span>cursor<span class="gtkdoc opt">,</span> index<span class="gtkdoc opt">,</span> NULL<span class="gtkdoc opt">, &amp;</span>error<span class="gtkdoc opt">)) {</span>

	<span class="keyword">if</span> <span class="gtkdoc opt">(</span><span class="function"><a href="https://developer.gnome.org/glib/unstable/glib-Error-Reporting.html#g-error-matches">g_error_matches</a></span> <span class="gtkdoc opt">(</span>error<span class="gtkdoc opt">,</span>
			     E_CLIENT_ERROR<span class="gtkdoc opt">,</span>
			     E_CLIENT_ERROR_OUT_OF_SYNC<span class="gtkdoc opt">)) {</span>

		<span class="comment">/* Just ignore the error.</span>
<span class="comment">		 *</span>
<span class="comment">		 * The addressbook locale has recently changed, very</span>
<span class="comment">		 * soon we will receive an alphabet change notification</span>
<span class="comment">		 * where we will reset the cursor position and reload</span>
<span class="comment">		 * the alphabet.</span>
<span class="comment">		 */</span>
		<span class="function">d</span> <span class="gtkdoc opt">(</span><span class="function"><a href="https://developer.gnome.org/glib/unstable/glib-Warnings-and-Assertions.html#g-print">g_print</a></span> <span class="gtkdoc opt">(</span><span class="string">&quot;Cursor was temporarily out of sync while setting the alphabetic target</span><span class="gtkdoc esc">\n</span><span class="string">&quot;</span><span class="gtkdoc opt">));</span>
	<span class="gtkdoc opt">}</span> <span class="keyword">else</span>
		<span class="function"><a href="https://developer.gnome.org/glib/unstable/glib-Message-Logging.html#g-warning">g_warning</a></span> <span class="gtkdoc opt">(</span><span class="string">&quot;Failed to move the cursor: %s&quot;</span><span class="gtkdoc opt">,</span> error<span class="gtkdoc opt">-&gt;</span>message<span class="gtkdoc opt">);</span>

	<span class="function"><a href="https://developer.gnome.org/glib/unstable/glib-Error-Reporting.html#g-clear-error">g_clear_error</a></span> <span class="gtkdoc opt">(&amp;</span>error<span class="gtkdoc opt">);</span>
<span class="gtkdoc opt">}</span>

<span class="comment">/* And load one page full of results starting with this index */</span>
<span class="keyword">if</span> <span class="gtkdoc opt">(!</span><span class="function">cursor_example_load_page</span> <span class="gtkdoc opt">(</span>example<span class="gtkdoc opt">, &amp;</span>full_results<span class="gtkdoc opt">))</span>
	<span class="keyword">return</span><span class="gtkdoc opt">;</span>

<span class="comment">/* If we hit the end of the results (less than a full page) then load the last page of results */</span>
<span class="keyword">if</span> <span class="gtkdoc opt">(!</span>full_results<span class="gtkdoc opt">) {</span>
	<span class="keyword">if</span> <span class="gtkdoc opt">(</span><span class="function">cursor_example_move_cursor</span> <span class="gtkdoc opt">(</span>example<span class="gtkdoc opt">,</span>
					E_BOOK_CURSOR_ORIGIN_END<span class="gtkdoc opt">,</span>
					<span class="number">0</span> <span class="gtkdoc opt">- (</span>N_SLOTS <span class="gtkdoc opt">+</span> <span class="number">1</span><span class="gtkdoc opt">))) {</span>
		<span class="function">cursor_example_load_page</span> <span class="gtkdoc opt">(</span>example<span class="gtkdoc opt">,</span> NULL<span class="gtkdoc opt">);</span>
	<span class="gtkdoc opt">}</span>
<span class="gtkdoc opt">}</span>
<span class="gtkdoc opt">}</span>

<span class="gtkdoc kwb">static void</span>
<span class="function">cursor_example_sexp_changed</span> <span class="gtkdoc opt">(</span>CursorExample <span class="gtkdoc opt">*</span>example<span class="gtkdoc opt">,</span>
                             GParamSpec <span class="gtkdoc opt">*</span>pspec<span class="gtkdoc opt">,</span>
                             CursorSearch <span class="gtkdoc opt">*</span>search<span class="gtkdoc opt">)</span>
<span class="gtkdoc opt">{</span>
CursorExamplePrivate <span class="gtkdoc opt">*</span>priv <span class="gtkdoc opt">=</span> example<span class="gtkdoc opt">-&gt;</span>priv<span class="gtkdoc opt">;</span>
gboolean              full_results <span class="gtkdoc opt">=</span> FALSE<span class="gtkdoc opt">;</span>
GError               <span class="gtkdoc opt">*</span>error <span class="gtkdoc opt">=</span> NULL<span class="gtkdoc opt">;</span>
<span class="gtkdoc kwb">const</span> gchar          <span class="gtkdoc opt">*</span>sexp<span class="gtkdoc opt">;</span>

sexp <span class="gtkdoc opt">=</span> <span class="function">cursor_search_get_sexp</span> <span class="gtkdoc opt">(</span>search<span class="gtkdoc opt">);</span>

<span class="function">d</span> <span class="gtkdoc opt">(</span><span class="function"><a href="https://developer.gnome.org/glib/unstable/glib-Warnings-and-Assertions.html#g-print">g_print</a></span> <span class="gtkdoc opt">(</span><span class="string">&quot;Search expression changed to: '%s'</span><span class="gtkdoc esc">\n</span><span class="string">&quot;</span><span class="gtkdoc opt">,</span> sexp<span class="gtkdoc opt">));</span>

<span class="comment">/* Set the search expression */</span>
<span class="keyword">if</span> <span class="gtkdoc opt">(!</span><span class="function"><a href="eds-EBookClientCursor.html#e-book-client-cursor-set-sexp-sync">e_book_client_cursor_set_sexp_sync</a></span> <span class="gtkdoc opt">(</span>priv<span class="gtkdoc opt">-&gt;</span>cursor<span class="gtkdoc opt">,</span> sexp<span class="gtkdoc opt">,</span> NULL<span class="gtkdoc opt">, &amp;</span>error<span class="gtkdoc opt">)) {</span>
	<span class="function"><a href="https://developer.gnome.org/glib/unstable/glib-Message-Logging.html#g-warning">g_warning</a></span> <span class="gtkdoc opt">(</span><span class="string">&quot;Failed to move the cursor: %s&quot;</span><span class="gtkdoc opt">,</span> error<span class="gtkdoc opt">-&gt;</span>message<span class="gtkdoc opt">);</span>
	<span class="function"><a href="https://developer.gnome.org/glib/unstable/glib-Error-Reporting.html#g-clear-error">g_clear_error</a></span> <span class="gtkdoc opt">(&amp;</span>error<span class="gtkdoc opt">);</span>
<span class="gtkdoc opt">}</span>

<span class="comment">/* And load one page full of results */</span>
<span class="keyword">if</span> <span class="gtkdoc opt">(!</span><span class="function">cursor_example_load_page</span> <span class="gtkdoc opt">(</span>example<span class="gtkdoc opt">, &amp;</span>full_results<span class="gtkdoc opt">))</span>
	<span class="keyword">return</span><span class="gtkdoc opt">;</span>

<span class="comment">/* If we hit the end of the results (less than a full page) then load the last page of results */</span>
<span class="keyword">if</span> <span class="gtkdoc opt">(!</span>full_results<span class="gtkdoc opt">)</span>
	<span class="keyword">if</span> <span class="gtkdoc opt">(</span><span class="function">cursor_example_move_cursor</span> <span class="gtkdoc opt">(</span>example<span class="gtkdoc opt">,</span>
					E_BOOK_CURSOR_ORIGIN_END<span class="gtkdoc opt">,</span>
					<span class="number">0</span> <span class="gtkdoc opt">- (</span>N_SLOTS <span class="gtkdoc opt">+</span> <span class="number">1</span><span class="gtkdoc opt">))) {</span>
		<span class="function">cursor_example_load_page</span> <span class="gtkdoc opt">(</span>example<span class="gtkdoc opt">,</span> NULL<span class="gtkdoc opt">);</span>
<span class="gtkdoc opt">}</span>
<span class="gtkdoc opt">}</span>

<span class="comment">/************************************************************************</span>
<span class="comment"> *                           EDS Callbacks                              *</span>
<span class="comment"> ************************************************************************/</span>
<span class="gtkdoc kwb">static void</span>
<span class="function">cursor_example_refresh</span> <span class="gtkdoc opt">(</span>EBookClientCursor <span class="gtkdoc opt">*</span>cursor<span class="gtkdoc opt">,</span>
                        CursorExample <span class="gtkdoc opt">*</span>example<span class="gtkdoc opt">)</span>
<span class="gtkdoc opt">{</span>
<span class="function">d</span> <span class="gtkdoc opt">(</span><span class="function"><a href="https://developer.gnome.org/glib/unstable/glib-Warnings-and-Assertions.html#g-print">g_print</a></span> <span class="gtkdoc opt">(</span><span class="string">&quot;Cursor refreshed</span><span class="gtkdoc esc">\n</span><span class="string">&quot;</span><span class="gtkdoc opt">));</span>

<span class="comment">/* Refresh the page */</span>
<span class="keyword">if</span> <span class="gtkdoc opt">(</span><span class="function">cursor_example_load_page</span> <span class="gtkdoc opt">(</span>example<span class="gtkdoc opt">,</span> NULL<span class="gtkdoc opt">))</span>
	<span class="function">cursor_example_update_status</span> <span class="gtkdoc opt">(</span>example<span class="gtkdoc opt">);</span>
<span class="gtkdoc opt">}</span>

<span class="gtkdoc kwb">static void</span>
<span class="function">cursor_example_alphabet_changed</span> <span class="gtkdoc opt">(</span>EBookClientCursor <span class="gtkdoc opt">*</span>cursor<span class="gtkdoc opt">,</span>
                                 GParamSpec <span class="gtkdoc opt">*</span>spec<span class="gtkdoc opt">,</span>
                                 CursorExample <span class="gtkdoc opt">*</span>example<span class="gtkdoc opt">)</span>
<span class="gtkdoc opt">{</span>
<span class="function">d</span> <span class="gtkdoc opt">(</span><span class="function"><a href="https://developer.gnome.org/glib/unstable/glib-Warnings-and-Assertions.html#g-print">g_print</a></span> <span class="gtkdoc opt">(</span><span class="string">&quot;Alphabet Changed</span><span class="gtkdoc esc">\n</span><span class="string">&quot;</span><span class="gtkdoc opt">));</span>

<span class="function">cursor_example_load_alphabet</span> <span class="gtkdoc opt">(</span>example<span class="gtkdoc opt">);</span>

<span class="comment">/* Get the first page of contacts in the addressbook */</span>
<span class="keyword">if</span> <span class="gtkdoc opt">(</span><span class="function">cursor_example_move_cursor</span> <span class="gtkdoc opt">(</span>example<span class="gtkdoc opt">,</span> E_BOOK_CURSOR_ORIGIN_BEGIN<span class="gtkdoc opt">,</span> <span class="number">0</span><span class="gtkdoc opt">))</span>
	<span class="function">cursor_example_load_page</span> <span class="gtkdoc opt">(</span>example<span class="gtkdoc opt">,</span> NULL<span class="gtkdoc opt">);</span>
<span class="gtkdoc opt">}</span>

<span class="gtkdoc kwb">static void</span>
<span class="function">cursor_example_status_changed</span> <span class="gtkdoc opt">(</span>EBookClientCursor <span class="gtkdoc opt">*</span>cursor<span class="gtkdoc opt">,</span>
                               GParamSpec <span class="gtkdoc opt">*</span>spec<span class="gtkdoc opt">,</span>
                               CursorExample <span class="gtkdoc opt">*</span>example<span class="gtkdoc opt">)</span>
<span class="gtkdoc opt">{</span>
<span class="function">d</span> <span class="gtkdoc opt">(</span><span class="function"><a href="https://developer.gnome.org/glib/unstable/glib-Warnings-and-Assertions.html#g-print">g_print</a></span> <span class="gtkdoc opt">(</span><span class="string">&quot;Status changed</span><span class="gtkdoc esc">\n</span><span class="string">&quot;</span><span class="gtkdoc opt">));</span>

<span class="function">cursor_example_update_status</span> <span class="gtkdoc opt">(</span>example<span class="gtkdoc opt">);</span>
<span class="gtkdoc opt">}</span>

<span class="comment">/************************************************************************</span>
<span class="comment"> *                             Utilities                                *</span>
<span class="comment"> ************************************************************************/</span>
<span class="gtkdoc kwb">static void</span>
<span class="function">cursor_example_load_alphabet</span> <span class="gtkdoc opt">(</span>CursorExample <span class="gtkdoc opt">*</span>example<span class="gtkdoc opt">)</span>
<span class="gtkdoc opt">{</span>
CursorExamplePrivate <span class="gtkdoc opt">*</span>priv <span class="gtkdoc opt">=</span> example<span class="gtkdoc opt">-&gt;</span>priv<span class="gtkdoc opt">;</span>
<span class="gtkdoc kwb">const</span> gchar <span class="gtkdoc opt">*</span><span class="gtkdoc kwb">const</span>   <span class="gtkdoc opt">*</span>alphabet<span class="gtkdoc opt">;</span>

<span class="comment">/* Update the alphabet on the navigator */</span>
alphabet <span class="gtkdoc opt">=</span> <span class="function">e_book_client_cursor_get_alphabet</span> <span class="gtkdoc opt">(</span>priv<span class="gtkdoc opt">-&gt;</span>cursor<span class="gtkdoc opt">,</span> NULL<span class="gtkdoc opt">,</span> NULL<span class="gtkdoc opt">,</span> NULL<span class="gtkdoc opt">,</span> NULL<span class="gtkdoc opt">);</span>
<span class="function">cursor_navigator_set_alphabet</span> <span class="gtkdoc opt">(</span>priv<span class="gtkdoc opt">-&gt;</span>navigator<span class="gtkdoc opt">,</span> alphabet<span class="gtkdoc opt">);</span>

<span class="comment">/* Reset navigator to the beginning */</span>
<span class="function"><a href="https://developer.gnome.org/gobject/unstable/gobject-Signals.html#g-signal-handlers-block-by-func">g_signal_handlers_block_by_func</a></span> <span class="gtkdoc opt">(</span>priv<span class="gtkdoc opt">-&gt;</span>navigator<span class="gtkdoc opt">,</span> cursor_example_navigator_changed<span class="gtkdoc opt">,</span> example<span class="gtkdoc opt">);</span>
<span class="function">cursor_navigator_set_index</span> <span class="gtkdoc opt">(</span>priv<span class="gtkdoc opt">-&gt;</span>navigator<span class="gtkdoc opt">,</span> <span class="number">0</span><span class="gtkdoc opt">);</span>
<span class="function"><a href="https://developer.gnome.org/gobject/unstable/gobject-Signals.html#g-signal-handlers-unblock-by-func">g_signal_handlers_unblock_by_func</a></span> <span class="gtkdoc opt">(</span>priv<span class="gtkdoc opt">-&gt;</span>navigator<span class="gtkdoc opt">,</span> cursor_example_navigator_changed<span class="gtkdoc opt">,</span> example<span class="gtkdoc opt">);</span>
<span class="gtkdoc opt">}</span>

<span class="gtkdoc kwb">static</span> gboolean
<span class="function">cursor_example_move_cursor</span> <span class="gtkdoc opt">(</span>CursorExample <span class="gtkdoc opt">*</span>example<span class="gtkdoc opt">,</span>
                            EBookCursorOrigin origin<span class="gtkdoc opt">,</span>
                            gint count<span class="gtkdoc opt">)</span>
<span class="gtkdoc opt">{</span>
CursorExamplePrivate <span class="gtkdoc opt">*</span>priv <span class="gtkdoc opt">=</span> example<span class="gtkdoc opt">-&gt;</span>priv<span class="gtkdoc opt">;</span>
GError               <span class="gtkdoc opt">*</span>error <span class="gtkdoc opt">=</span> NULL<span class="gtkdoc opt">;</span>
gint                  n_results<span class="gtkdoc opt">;</span>

n_results <span class="gtkdoc opt">=</span> <span class="function"><a href="eds-EBookClientCursor.html#e-book-client-cursor-step-sync">e_book_client_cursor_step_sync</a></span> <span class="gtkdoc opt">(</span>
	priv<span class="gtkdoc opt">-&gt;</span>cursor<span class="gtkdoc opt">,</span>
	E_BOOK_CURSOR_STEP_MOVE<span class="gtkdoc opt">,</span>
	origin<span class="gtkdoc opt">,</span>
	count<span class="gtkdoc opt">,</span>
	NULL<span class="gtkdoc opt">,</span> <span class="comment">/* Result list */</span>
	NULL<span class="gtkdoc opt">,</span> <span class="comment">/* GCancellable */</span>
	<span class="gtkdoc opt">&amp;</span>error<span class="gtkdoc opt">);</span>

<span class="keyword">if</span> <span class="gtkdoc opt">(</span>n_results <span class="gtkdoc opt">&lt;</span> <span class="number">0</span><span class="gtkdoc opt">) {</span>

	<span class="keyword">if</span> <span class="gtkdoc opt">(</span><span class="function"><a href="https://developer.gnome.org/glib/unstable/glib-Error-Reporting.html#g-error-matches">g_error_matches</a></span> <span class="gtkdoc opt">(</span>error<span class="gtkdoc opt">,</span>
			     E_CLIENT_ERROR<span class="gtkdoc opt">,</span>
			     E_CLIENT_ERROR_OUT_OF_SYNC<span class="gtkdoc opt">)) {</span>

		<span class="comment">/* The addressbook has very recently been modified,</span>
<span class="comment">		 * very soon we will receive a &quot;refresh&quot; signal and</span>
<span class="comment">		 * automatically reload the current page position.</span>
<span class="comment">		 */</span>
		<span class="function">d</span> <span class="gtkdoc opt">(</span><span class="function"><a href="https://developer.gnome.org/glib/unstable/glib-Warnings-and-Assertions.html#g-print">g_print</a></span> <span class="gtkdoc opt">(</span><span class="string">&quot;Cursor was temporarily out of sync while moving</span><span class="gtkdoc esc">\n</span><span class="string">&quot;</span><span class="gtkdoc opt">));</span>

	<span class="gtkdoc opt">}</span> <span class="keyword">else if</span> <span class="gtkdoc opt">(</span><span class="function"><a href="https://developer.gnome.org/glib/unstable/glib-Error-Reporting.html#g-error-matches">g_error_matches</a></span> <span class="gtkdoc opt">(</span>error<span class="gtkdoc opt">,</span>
				    E_CLIENT_ERROR<span class="gtkdoc opt">,</span>
				    E_CLIENT_ERROR_QUERY_REFUSED<span class="gtkdoc opt">)) {</span>

		<span class="function">d</span> <span class="gtkdoc opt">(</span><span class="function"><a href="https://developer.gnome.org/glib/unstable/glib-Warnings-and-Assertions.html#g-print">g_print</a></span> <span class="gtkdoc opt">(</span><span class="string">&quot;End of list was reached</span><span class="gtkdoc esc">\n</span><span class="string">&quot;</span><span class="gtkdoc opt">));</span>

	<span class="gtkdoc opt">}</span> <span class="keyword">else</span>
		<span class="function"><a href="https://developer.gnome.org/glib/unstable/glib-Message-Logging.html#g-warning">g_warning</a></span> <span class="gtkdoc opt">(</span><span class="string">&quot;Failed to move the cursor: %s&quot;</span><span class="gtkdoc opt">,</span> error<span class="gtkdoc opt">-&gt;</span>message<span class="gtkdoc opt">);</span>

	<span class="function"><a href="https://developer.gnome.org/glib/unstable/glib-Error-Reporting.html#g-clear-error">g_clear_error</a></span> <span class="gtkdoc opt">(&amp;</span>error<span class="gtkdoc opt">);</span>

<span class="gtkdoc opt">}</span>

<span class="keyword">return</span> n_results <span class="gtkdoc opt">&gt;=</span> <span class="number">0</span><span class="gtkdoc opt">;</span>
<span class="gtkdoc opt">}</span>

<span class="comment">/* Loads a page at the current cursor position, returns</span>
<span class="comment"> * FALSE if there was an error.</span>
<span class="comment"> */</span>
<span class="gtkdoc kwb">static</span> gboolean
<span class="function">cursor_example_load_page</span> <span class="gtkdoc opt">(</span>CursorExample <span class="gtkdoc opt">*</span>example<span class="gtkdoc opt">,</span>
                          gboolean <span class="gtkdoc opt">*</span>full_results<span class="gtkdoc opt">)</span>
<span class="gtkdoc opt">{</span>
CursorExamplePrivate <span class="gtkdoc opt">*</span>priv <span class="gtkdoc opt">=</span> example<span class="gtkdoc opt">-&gt;</span>priv<span class="gtkdoc opt">;</span>
GError               <span class="gtkdoc opt">*</span>error <span class="gtkdoc opt">=</span> NULL<span class="gtkdoc opt">;</span>
GSList               <span class="gtkdoc opt">*</span>results <span class="gtkdoc opt">=</span> NULL<span class="gtkdoc opt">;</span>
gint                  n_results<span class="gtkdoc opt">;</span>

<span class="comment">/* Fetch N_SLOTS contacts after the current cursor position,</span>
<span class="comment"> * without modifying the current cursor position</span>
<span class="comment"> */</span>
n_results <span class="gtkdoc opt">=</span> <span class="function"><a href="eds-EBookClientCursor.html#e-book-client-cursor-step-sync">e_book_client_cursor_step_sync</a></span> <span class="gtkdoc opt">(</span>
	priv<span class="gtkdoc opt">-&gt;</span>cursor<span class="gtkdoc opt">,</span>
	E_BOOK_CURSOR_STEP_FETCH<span class="gtkdoc opt">,</span>
	E_BOOK_CURSOR_ORIGIN_CURRENT<span class="gtkdoc opt">,</span>
	N_SLOTS<span class="gtkdoc opt">,</span>
	<span class="gtkdoc opt">&amp;</span>results<span class="gtkdoc opt">,</span>
	NULL<span class="gtkdoc opt">,</span> <span class="comment">/* GCancellable */</span>
	<span class="gtkdoc opt">&amp;</span>error<span class="gtkdoc opt">);</span>

<span class="keyword">if</span> <span class="gtkdoc opt">(</span>n_results <span class="gtkdoc opt">&lt;</span> <span class="number">0</span><span class="gtkdoc opt">) {</span>
	<span class="keyword">if</span> <span class="gtkdoc opt">(</span><span class="function"><a href="https://developer.gnome.org/glib/unstable/glib-Error-Reporting.html#g-error-matches">g_error_matches</a></span> <span class="gtkdoc opt">(</span>error<span class="gtkdoc opt">,</span>
			     E_CLIENT_ERROR<span class="gtkdoc opt">,</span>
			     E_CLIENT_ERROR_OUT_OF_SYNC<span class="gtkdoc opt">)) {</span>

		<span class="comment">/* The addressbook has very recently been modified,</span>
<span class="comment">		 * very soon we will receive a &quot;refresh&quot; signal and</span>
<span class="comment">		 * automatically reload the current page position.</span>
<span class="comment">		 */</span>
		<span class="function">d</span> <span class="gtkdoc opt">(</span><span class="function"><a href="https://developer.gnome.org/glib/unstable/glib-Warnings-and-Assertions.html#g-print">g_print</a></span> <span class="gtkdoc opt">(</span><span class="string">&quot;Cursor was temporarily out of sync while loading page</span><span class="gtkdoc esc">\n</span><span class="string">&quot;</span><span class="gtkdoc opt">));</span>

	<span class="gtkdoc opt">}</span> <span class="keyword">else if</span> <span class="gtkdoc opt">(</span><span class="function"><a href="https://developer.gnome.org/glib/unstable/glib-Error-Reporting.html#g-error-matches">g_error_matches</a></span> <span class="gtkdoc opt">(</span>error<span class="gtkdoc opt">,</span>
				    E_CLIENT_ERROR<span class="gtkdoc opt">,</span>
				    E_CLIENT_ERROR_QUERY_REFUSED<span class="gtkdoc opt">)) {</span>

		<span class="function">d</span> <span class="gtkdoc opt">(</span><span class="function"><a href="https://developer.gnome.org/glib/unstable/glib-Warnings-and-Assertions.html#g-print">g_print</a></span> <span class="gtkdoc opt">(</span><span class="string">&quot;End of list was reached</span><span class="gtkdoc esc">\n</span><span class="string">&quot;</span><span class="gtkdoc opt">));</span>

	<span class="gtkdoc opt">}</span> <span class="keyword">else</span>
		<span class="function"><a href="https://developer.gnome.org/glib/unstable/glib-Message-Logging.html#g-warning">g_warning</a></span> <span class="gtkdoc opt">(</span><span class="string">&quot;Failed to move the cursor: %s&quot;</span><span class="gtkdoc opt">,</span> error<span class="gtkdoc opt">-&gt;</span>message<span class="gtkdoc opt">);</span>

	<span class="function"><a href="https://developer.gnome.org/glib/unstable/glib-Error-Reporting.html#g-clear-error">g_clear_error</a></span> <span class="gtkdoc opt">(&amp;</span>error<span class="gtkdoc opt">);</span>

<span class="gtkdoc opt">}</span> <span class="keyword">else</span> <span class="gtkdoc opt">{</span>
	<span class="comment">/* Display the results */</span>
	EContact             <span class="gtkdoc opt">*</span>contact<span class="gtkdoc opt">;</span>
	gint                  i<span class="gtkdoc opt">;</span>

	<span class="comment">/* Fill the page with results for the current cursor position</span>
<span class="comment">	 */</span>
	<span class="keyword">for</span> <span class="gtkdoc opt">(</span>i <span class="gtkdoc opt">=</span> <span class="number">0</span><span class="gtkdoc opt">;</span> i <span class="gtkdoc opt">&lt;</span> N_SLOTS<span class="gtkdoc opt">;</span> i<span class="gtkdoc opt">++) {</span>
		contact <span class="gtkdoc opt">=</span> <span class="function"><a href="https://developer.gnome.org/glib/unstable/glib-Singly-Linked-Lists.html#g-slist-nth-data">g_slist_nth_data</a></span> <span class="gtkdoc opt">(</span>results<span class="gtkdoc opt">,</span> i<span class="gtkdoc opt">);</span>

		<span class="comment">/* For the first contact, give some visual feedback about where we</span>
<span class="comment">		 * are in the list, which alphabet character we're browsing right now.</span>
<span class="comment">		 */</span>
		<span class="keyword">if</span> <span class="gtkdoc opt">(</span>i <span class="gtkdoc opt">==</span> <span class="number">0</span> <span class="gtkdoc opt">&amp;&amp;</span> contact<span class="gtkdoc opt">)</span>
			<span class="function">cursor_example_update_current_index</span> <span class="gtkdoc opt">(</span>example<span class="gtkdoc opt">,</span> contact<span class="gtkdoc opt">);</span>

		<span class="function">cursor_slot_set_from_contact</span> <span class="gtkdoc opt">(</span><span class="function">CURSOR_SLOT</span> <span class="gtkdoc opt">(</span>priv<span class="gtkdoc opt">-&gt;</span>slots<span class="gtkdoc opt">[</span>i<span class="gtkdoc opt">]),</span> contact<span class="gtkdoc opt">);</span>
	<span class="gtkdoc opt">}</span>
<span class="gtkdoc opt">}</span>

<span class="keyword">if</span> <span class="gtkdoc opt">(</span>full_results<span class="gtkdoc opt">)</span>
	<span class="gtkdoc opt">*</span>full_results <span class="gtkdoc opt">= (</span>n_results <span class="gtkdoc opt">==</span> N_SLOTS<span class="gtkdoc opt">);</span>

<span class="function"><a href="https://developer.gnome.org/glib/unstable/glib-Singly-Linked-Lists.html#g-slist-free-full">g_slist_free_full</a></span> <span class="gtkdoc opt">(</span>results<span class="gtkdoc opt">, (</span>GDestroyNotify<span class="gtkdoc opt">)</span> g_object_unref<span class="gtkdoc opt">);</span>

<span class="keyword">return</span> n_results <span class="gtkdoc opt">&gt;=</span> <span class="number">0</span><span class="gtkdoc opt">;</span>
<span class="gtkdoc opt">}</span>

<span class="gtkdoc kwb">static void</span>
<span class="function">cursor_example_update_status</span> <span class="gtkdoc opt">(</span>CursorExample <span class="gtkdoc opt">*</span>example<span class="gtkdoc opt">)</span>
<span class="gtkdoc opt">{</span>
CursorExamplePrivate <span class="gtkdoc opt">*</span>priv <span class="gtkdoc opt">=</span> example<span class="gtkdoc opt">-&gt;</span>priv<span class="gtkdoc opt">;</span>
gint                  total<span class="gtkdoc opt">,</span> position<span class="gtkdoc opt">;</span>
gchar                <span class="gtkdoc opt">*</span>txt<span class="gtkdoc opt">;</span>
gboolean              up_sensitive<span class="gtkdoc opt">;</span>
gboolean              down_sensitive<span class="gtkdoc opt">;</span>
gdouble               fraction<span class="gtkdoc opt">;</span>

total <span class="gtkdoc opt">=</span> <span class="function"><a href="eds-EBookClientCursor.html#e-book-client-cursor-get-total">e_book_client_cursor_get_total</a></span> <span class="gtkdoc opt">(</span>priv<span class="gtkdoc opt">-&gt;</span>cursor<span class="gtkdoc opt">);</span>
position <span class="gtkdoc opt">=</span> <span class="function"><a href="eds-EBookClientCursor.html#e-book-client-cursor-get-position">e_book_client_cursor_get_position</a></span> <span class="gtkdoc opt">(</span>priv<span class="gtkdoc opt">-&gt;</span>cursor<span class="gtkdoc opt">);</span>

<span class="comment">/* Set the label showing the cursor position and total contacts */</span>
txt <span class="gtkdoc opt">=</span> <span class="function"><a href="https://developer.gnome.org/glib/unstable/glib-String-Utility-Functions.html#g-strdup-printf">g_strdup_printf</a></span> <span class="gtkdoc opt">(</span><span class="string">&quot;Position %d / Total %d&quot;</span><span class="gtkdoc opt">,</span> position<span class="gtkdoc opt">,</span> total<span class="gtkdoc opt">);</span>
<span class="function"><a href="http://developer.gnome.org/gtk2/GtkProgressBar.html#gtk-progress-bar-set-text">gtk_progress_bar_set_text</a></span> <span class="gtkdoc opt">(</span><span class="function">GTK_PROGRESS_BAR</span> <span class="gtkdoc opt">(</span>priv<span class="gtkdoc opt">-&gt;</span>progressbar<span class="gtkdoc opt">),</span> txt<span class="gtkdoc opt">);</span>
<span class="function"><a href="https://developer.gnome.org/glib/unstable/glib-Memory-Allocation.html#g-free">g_free</a></span> <span class="gtkdoc opt">(</span>txt<span class="gtkdoc opt">);</span>

<span class="comment">/* Give visual feedback on how far we are into the contact list */</span>
fraction <span class="gtkdoc opt">=</span> position <span class="gtkdoc opt">*</span> <span class="number">1.0</span>F <span class="gtkdoc opt">/ (</span>total <span class="gtkdoc opt">-</span> N_SLOTS<span class="gtkdoc opt">);</span>
<span class="function"><a href="http://developer.gnome.org/gtk2/GtkProgressBar.html#gtk-progress-bar-set-fraction">gtk_progress_bar_set_fraction</a></span> <span class="gtkdoc opt">(</span><span class="function">GTK_PROGRESS_BAR</span> <span class="gtkdoc opt">(</span>priv<span class="gtkdoc opt">-&gt;</span>progressbar<span class="gtkdoc opt">),</span> fraction<span class="gtkdoc opt">);</span>

<span class="comment">/* Update sensitivity of buttons */</span>
<span class="keyword">if</span> <span class="gtkdoc opt">(</span>total <span class="gtkdoc opt">&lt;=</span> N_SLOTS<span class="gtkdoc opt">) {</span>
	<span class="comment">/* If the amount of contacts is less than the amount of visual slots,</span>
<span class="comment">	 * then we cannot browse up and down</span>
<span class="comment">	 */</span>
	up_sensitive <span class="gtkdoc opt">=</span> FALSE<span class="gtkdoc opt">;</span>
	down_sensitive <span class="gtkdoc opt">=</span> FALSE<span class="gtkdoc opt">;</span>
<span class="gtkdoc opt">}</span> <span class="keyword">else</span> <span class="gtkdoc opt">{</span>
	<span class="comment">/* The cursor is always pointing directly before</span>
<span class="comment">	 * the first contact visible in the view, so if the</span>
<span class="comment">	 * cursor is passed the first contact we can rewind.</span>
<span class="comment">	 */</span>
	up_sensitive <span class="gtkdoc opt">=</span> position <span class="gtkdoc opt">&gt;</span> <span class="number">0</span><span class="gtkdoc opt">;</span>

	<span class="comment">/* If more than N_SLOTS contacts remain, then</span>
<span class="comment">	 * we can still scroll down */</span>
	down_sensitive <span class="gtkdoc opt">=</span> position <span class="gtkdoc opt">&lt;</span> total <span class="gtkdoc opt">-</span> N_SLOTS<span class="gtkdoc opt">;</span>
<span class="gtkdoc opt">}</span>

<span class="function"><a href="http://developer.gnome.org/gtk2/GtkWidget.html#gtk-widget-set-sensitive">gtk_widget_set_sensitive</a></span> <span class="gtkdoc opt">(</span>priv<span class="gtkdoc opt">-&gt;</span>browse_up_button<span class="gtkdoc opt">,</span> up_sensitive<span class="gtkdoc opt">);</span>
<span class="function"><a href="http://developer.gnome.org/gtk2/GtkWidget.html#gtk-widget-set-sensitive">gtk_widget_set_sensitive</a></span> <span class="gtkdoc opt">(</span>priv<span class="gtkdoc opt">-&gt;</span>browse_down_button<span class="gtkdoc opt">,</span> down_sensitive<span class="gtkdoc opt">);</span>
<span class="gtkdoc opt">}</span>

<span class="comment">/* This is called when refreshing the window contents with</span>
<span class="comment"> * the first contact shown in the window.</span>
<span class="comment"> */</span>
<span class="gtkdoc kwb">static void</span>
<span class="function">cursor_example_update_current_index</span> <span class="gtkdoc opt">(</span>CursorExample <span class="gtkdoc opt">*</span>example<span class="gtkdoc opt">,</span>
                                     EContact <span class="gtkdoc opt">*</span>contact<span class="gtkdoc opt">)</span>
<span class="gtkdoc opt">{</span>
CursorExamplePrivate <span class="gtkdoc opt">*</span>priv <span class="gtkdoc opt">=</span> example<span class="gtkdoc opt">-&gt;</span>priv<span class="gtkdoc opt">;</span>
<span class="gtkdoc kwb">const</span> gchar <span class="gtkdoc opt">*</span><span class="gtkdoc kwb">const</span>   <span class="gtkdoc opt">*</span>labels<span class="gtkdoc opt">;</span>
gint                  index<span class="gtkdoc opt">;</span>

<span class="comment">/* Fetch the alphabetic index for this contact */</span>
index <span class="gtkdoc opt">=</span> <span class="function"><a href="eds-EBookClientCursor.html#e-book-client-cursor-get-contact-alphabetic-index">e_book_client_cursor_get_contact_alphabetic_index</a></span> <span class="gtkdoc opt">(</span>priv<span class="gtkdoc opt">-&gt;</span>cursor<span class="gtkdoc opt">,</span> contact<span class="gtkdoc opt">);</span>

<span class="comment">/* Refresh the current alphabet index indicator.</span>
<span class="comment"> *</span>
<span class="comment"> * The index returned by e_book_client_cursor_get_contact_alphabetic_index() is</span>
<span class="comment"> * a valid position into the array returned by e_book_client_cursor_get_alphabet().</span>
<span class="comment"> */</span>
labels <span class="gtkdoc opt">=</span> <span class="function">e_book_client_cursor_get_alphabet</span> <span class="gtkdoc opt">(</span>priv<span class="gtkdoc opt">-&gt;</span>cursor<span class="gtkdoc opt">,</span> NULL<span class="gtkdoc opt">,</span> NULL<span class="gtkdoc opt">,</span> NULL<span class="gtkdoc opt">,</span> NULL<span class="gtkdoc opt">);</span>
<span class="function"><a href="http://developer.gnome.org/gtk2/GtkLabel.html#gtk-label-set-text">gtk_label_set_text</a></span> <span class="gtkdoc opt">(</span><span class="function">GTK_LABEL</span> <span class="gtkdoc opt">(</span>priv<span class="gtkdoc opt">-&gt;</span>alphabet_label<span class="gtkdoc opt">),</span> labels<span class="gtkdoc opt">[</span>index<span class="gtkdoc opt">]);</span>

<span class="comment">/* Update the current scroll position (and avoid reacting to the value change)</span>
<span class="comment"> */</span>
<span class="keyword">if</span> <span class="gtkdoc opt">(</span>contact<span class="gtkdoc opt">) {</span>
	<span class="function"><a href="https://developer.gnome.org/gobject/unstable/gobject-Signals.html#g-signal-handlers-block-by-func">g_signal_handlers_block_by_func</a></span> <span class="gtkdoc opt">(</span>priv<span class="gtkdoc opt">-&gt;</span>navigator<span class="gtkdoc opt">,</span> cursor_example_navigator_changed<span class="gtkdoc opt">,</span> example<span class="gtkdoc opt">);</span>
	<span class="function">cursor_navigator_set_index</span> <span class="gtkdoc opt">(</span>priv<span class="gtkdoc opt">-&gt;</span>navigator<span class="gtkdoc opt">,</span> index<span class="gtkdoc opt">);</span>
	<span class="function"><a href="https://developer.gnome.org/gobject/unstable/gobject-Signals.html#g-signal-handlers-unblock-by-func">g_signal_handlers_unblock_by_func</a></span> <span class="gtkdoc opt">(</span>priv<span class="gtkdoc opt">-&gt;</span>navigator<span class="gtkdoc opt">,</span> cursor_example_navigator_changed<span class="gtkdoc opt">,</span> example<span class="gtkdoc opt">);</span>
<span class="gtkdoc opt">}</span>
<span class="gtkdoc opt">}</span>

<span class="gtkdoc kwb">static</span> gboolean
<span class="function">cursor_example_timeout</span> <span class="gtkdoc opt">(</span>CursorExample <span class="gtkdoc opt">*</span>example<span class="gtkdoc opt">)</span>
<span class="gtkdoc opt">{</span>
CursorExamplePrivate <span class="gtkdoc opt">*</span>priv <span class="gtkdoc opt">=</span> example<span class="gtkdoc opt">-&gt;</span>priv<span class="gtkdoc opt">;</span>
gboolean can_move<span class="gtkdoc opt">;</span>

<span class="keyword">switch</span> <span class="gtkdoc opt">(</span>priv<span class="gtkdoc opt">-&gt;</span>activity<span class="gtkdoc opt">) {</span>
<span class="keyword">case</span> TIMEOUT_NONE<span class="gtkdoc opt">:</span>
	<span class="keyword">break</span><span class="gtkdoc opt">;</span>

<span class="keyword">case</span> TIMEOUT_UP_INITIAL<span class="gtkdoc opt">:</span>
<span class="keyword">case</span> TIMEOUT_UP_TICK<span class="gtkdoc opt">:</span>

	<span class="comment">/* Move the cursor backwards by 1 and then refresh the page */</span>
	<span class="keyword">if</span> <span class="gtkdoc opt">(</span><span class="function">cursor_example_move_cursor</span> <span class="gtkdoc opt">(</span>example<span class="gtkdoc opt">,</span> E_BOOK_CURSOR_ORIGIN_CURRENT<span class="gtkdoc opt">,</span> <span class="number">0</span> <span class="gtkdoc opt">-</span> <span class="number">1</span><span class="gtkdoc opt">)) {</span>
		<span class="function">cursor_example_load_page</span> <span class="gtkdoc opt">(</span>example<span class="gtkdoc opt">,</span> NULL<span class="gtkdoc opt">);</span>
		<span class="function">cursor_example_ensure_timeout</span> <span class="gtkdoc opt">(</span>example<span class="gtkdoc opt">,</span> TIMEOUT_UP_TICK<span class="gtkdoc opt">);</span>
	<span class="gtkdoc opt">}</span> <span class="keyword">else</span>
		<span class="function">cursor_example_cancel_timeout</span> <span class="gtkdoc opt">(</span>example<span class="gtkdoc opt">);</span>

	<span class="keyword">break</span><span class="gtkdoc opt">;</span>

<span class="keyword">case</span> TIMEOUT_DOWN_INITIAL<span class="gtkdoc opt">:</span>
<span class="keyword">case</span> TIMEOUT_DOWN_TICK<span class="gtkdoc opt">:</span>

	<span class="comment">/* Avoid scrolling past the end of the list - N_SLOTS */</span>
	can_move <span class="gtkdoc opt">= (</span><span class="function"><a href="eds-EBookClientCursor.html#e-book-client-cursor-get-position">e_book_client_cursor_get_position</a></span> <span class="gtkdoc opt">(</span>priv<span class="gtkdoc opt">-&gt;</span>cursor<span class="gtkdoc opt">) &lt;</span>
		    <span class="function"><a href="eds-EBookClientCursor.html#e-book-client-cursor-get-total">e_book_client_cursor_get_total</a></span> <span class="gtkdoc opt">(</span>priv<span class="gtkdoc opt">-&gt;</span>cursor<span class="gtkdoc opt">) -</span> N_SLOTS<span class="gtkdoc opt">);</span>

	<span class="comment">/* Move the cursor forwards by 1 and then refresh the page */</span>
	<span class="keyword">if</span> <span class="gtkdoc opt">(</span>can_move <span class="gtkdoc opt">&amp;&amp;</span>
	    <span class="function">cursor_example_move_cursor</span> <span class="gtkdoc opt">(</span>example<span class="gtkdoc opt">,</span> E_BOOK_CURSOR_ORIGIN_CURRENT<span class="gtkdoc opt">,</span> <span class="number">1</span><span class="gtkdoc opt">)) {</span>
		<span class="function">cursor_example_load_page</span> <span class="gtkdoc opt">(</span>example<span class="gtkdoc opt">,</span> NULL<span class="gtkdoc opt">);</span>
		<span class="function">cursor_example_ensure_timeout</span> <span class="gtkdoc opt">(</span>example<span class="gtkdoc opt">,</span> TIMEOUT_DOWN_TICK<span class="gtkdoc opt">);</span>
	<span class="gtkdoc opt">}</span> <span class="keyword">else</span>
		<span class="function">cursor_example_cancel_timeout</span> <span class="gtkdoc opt">(</span>example<span class="gtkdoc opt">);</span>

	<span class="keyword">break</span><span class="gtkdoc opt">;</span>
<span class="gtkdoc opt">}</span>

<span class="keyword">return</span> FALSE<span class="gtkdoc opt">;</span>
<span class="gtkdoc opt">}</span>

<span class="gtkdoc kwb">static void</span>
<span class="function">cursor_example_ensure_timeout</span> <span class="gtkdoc opt">(</span>CursorExample <span class="gtkdoc opt">*</span>example<span class="gtkdoc opt">,</span>
                               TimeoutActivity activity<span class="gtkdoc opt">)</span>
<span class="gtkdoc opt">{</span>
CursorExamplePrivate <span class="gtkdoc opt">*</span>priv <span class="gtkdoc opt">=</span> example<span class="gtkdoc opt">-&gt;</span>priv<span class="gtkdoc opt">;</span>
guint                 timeout <span class="gtkdoc opt">=</span> <span class="number">0</span><span class="gtkdoc opt">;</span>

<span class="function">cursor_example_cancel_timeout</span> <span class="gtkdoc opt">(</span>example<span class="gtkdoc opt">);</span>

<span class="keyword">if</span> <span class="gtkdoc opt">(</span>activity <span class="gtkdoc opt">==</span> TIMEOUT_UP_INITIAL <span class="gtkdoc opt">||</span>
    activity <span class="gtkdoc opt">==</span> TIMEOUT_DOWN_INITIAL<span class="gtkdoc opt">)</span>
	timeout <span class="gtkdoc opt">=</span> INITIAL_TIMEOUT<span class="gtkdoc opt">;</span>
<span class="keyword">else</span>
	timeout <span class="gtkdoc opt">=</span> TICK_TIMEOUT<span class="gtkdoc opt">;</span>

priv<span class="gtkdoc opt">-&gt;</span>activity <span class="gtkdoc opt">=</span> activity<span class="gtkdoc opt">;</span>

priv<span class="gtkdoc opt">-&gt;</span>timeout_id <span class="gtkdoc opt">=</span>
	<span class="function"><a href="https://developer.gnome.org/glib/unstable/glib-The-Main-Event-Loop.html#g-timeout-add">g_timeout_add</a></span> <span class="gtkdoc opt">(</span>
		timeout<span class="gtkdoc opt">,</span>
		<span class="gtkdoc opt">(</span>GSourceFunc<span class="gtkdoc opt">)</span> cursor_example_timeout<span class="gtkdoc opt">,</span>
		example<span class="gtkdoc opt">);</span>
<span class="gtkdoc opt">}</span>

<span class="gtkdoc kwb">static void</span>
<span class="function">cursor_example_cancel_timeout</span> <span class="gtkdoc opt">(</span>CursorExample <span class="gtkdoc opt">*</span>example<span class="gtkdoc opt">)</span>
<span class="gtkdoc opt">{</span>
CursorExamplePrivate <span class="gtkdoc opt">*</span>priv <span class="gtkdoc opt">=</span> example<span class="gtkdoc opt">-&gt;</span>priv<span class="gtkdoc opt">;</span>

<span class="keyword">if</span> <span class="gtkdoc opt">(</span>priv<span class="gtkdoc opt">-&gt;</span>timeout_id<span class="gtkdoc opt">) {</span>
	<span class="function"><a href="https://developer.gnome.org/glib/unstable/glib-The-Main-Event-Loop.html#g-source-remove">g_source_remove</a></span> <span class="gtkdoc opt">(</span>priv<span class="gtkdoc opt">-&gt;</span>timeout_id<span class="gtkdoc opt">);</span>
	priv<span class="gtkdoc opt">-&gt;</span>timeout_id <span class="gtkdoc opt">=</span> <span class="number">0</span><span class="gtkdoc opt">;</span>
<span class="gtkdoc opt">}</span>
<span class="gtkdoc opt">}</span>

<span class="comment">/************************************************************************</span>
<span class="comment"> *                                API                                   *</span>
<span class="comment"> ************************************************************************/</span>
GtkWidget <span class="gtkdoc opt">*</span>
<span class="function">cursor_example_new</span> <span class="gtkdoc opt">(</span><span class="gtkdoc kwb">const</span> gchar <span class="gtkdoc opt">*</span>vcard_path<span class="gtkdoc opt">)</span>
<span class="gtkdoc opt">{</span>
  CursorExample <span class="gtkdoc opt">*</span>example<span class="gtkdoc opt">;</span>
  CursorExamplePrivate <span class="gtkdoc opt">*</span>priv<span class="gtkdoc opt">;</span>

  example <span class="gtkdoc opt">=</span> <span class="function"><a href="https://developer.gnome.org/gobject/unstable/gobject-The-Base-Object-Type.html#g-object-new">g_object_new</a></span> <span class="gtkdoc opt">(</span>CURSOR_TYPE_EXAMPLE<span class="gtkdoc opt">,</span> NULL<span class="gtkdoc opt">);</span>
  priv <span class="gtkdoc opt">=</span> example<span class="gtkdoc opt">-&gt;</span>priv<span class="gtkdoc opt">;</span>

  priv<span class="gtkdoc opt">-&gt;</span>client <span class="gtkdoc opt">=</span> <span class="function">cursor_load_data</span> <span class="gtkdoc opt">(</span>vcard_path<span class="gtkdoc opt">, &amp;</span>priv<span class="gtkdoc opt">-&gt;</span>cursor<span class="gtkdoc opt">);</span>

  <span class="function">cursor_example_load_alphabet</span> <span class="gtkdoc opt">(</span>example<span class="gtkdoc opt">);</span>

  <span class="comment">/* Load the first page of results */</span>
  <span class="function">cursor_example_load_page</span> <span class="gtkdoc opt">(</span>example<span class="gtkdoc opt">,</span> NULL<span class="gtkdoc opt">);</span>
  <span class="function">cursor_example_update_status</span> <span class="gtkdoc opt">(</span>example<span class="gtkdoc opt">);</span>

  <span class="function"><a href="https://developer.gnome.org/gobject/unstable/gobject-Signals.html#g-signal-connect">g_signal_connect</a></span> <span class="gtkdoc opt">(</span>priv<span class="gtkdoc opt">-&gt;</span>cursor<span class="gtkdoc opt">,</span> <span class="string">&quot;refresh&quot;</span><span class="gtkdoc opt">,</span>
	    <span class="function"><a href="https://developer.gnome.org/gobject/unstable/gobject-Closures.html#G-CALLBACK:CAPS">G_CALLBACK</a></span> <span class="gtkdoc opt">(</span>cursor_example_refresh<span class="gtkdoc opt">),</span> example<span class="gtkdoc opt">);</span>
  <span class="function"><a href="https://developer.gnome.org/gobject/unstable/gobject-Signals.html#g-signal-connect">g_signal_connect</a></span> <span class="gtkdoc opt">(</span>priv<span class="gtkdoc opt">-&gt;</span>cursor<span class="gtkdoc opt">,</span> <span class="string">&quot;notify::alphabet&quot;</span><span class="gtkdoc opt">,</span>
	    <span class="function"><a href="https://developer.gnome.org/gobject/unstable/gobject-Closures.html#G-CALLBACK:CAPS">G_CALLBACK</a></span> <span class="gtkdoc opt">(</span>cursor_example_alphabet_changed<span class="gtkdoc opt">),</span> example<span class="gtkdoc opt">);</span>
  <span class="function"><a href="https://developer.gnome.org/gobject/unstable/gobject-Signals.html#g-signal-connect">g_signal_connect</a></span> <span class="gtkdoc opt">(</span>priv<span class="gtkdoc opt">-&gt;</span>cursor<span class="gtkdoc opt">,</span> <span class="string">&quot;notify::total&quot;</span><span class="gtkdoc opt">,</span>
	    <span class="function"><a href="https://developer.gnome.org/gobject/unstable/gobject-Closures.html#G-CALLBACK:CAPS">G_CALLBACK</a></span> <span class="gtkdoc opt">(</span>cursor_example_status_changed<span class="gtkdoc opt">),</span> example<span class="gtkdoc opt">);</span>
  <span class="function"><a href="https://developer.gnome.org/gobject/unstable/gobject-Signals.html#g-signal-connect">g_signal_connect</a></span> <span class="gtkdoc opt">(</span>priv<span class="gtkdoc opt">-&gt;</span>cursor<span class="gtkdoc opt">,</span> <span class="string">&quot;notify::position&quot;</span><span class="gtkdoc opt">,</span>
	    <span class="function"><a href="https://developer.gnome.org/gobject/unstable/gobject-Closures.html#G-CALLBACK:CAPS">G_CALLBACK</a></span> <span class="gtkdoc opt">(</span>cursor_example_status_changed<span class="gtkdoc opt">),</span> example<span class="gtkdoc opt">);</span>

  <span class="function"><a href="https://developer.gnome.org/glib/unstable/glib-Message-Logging.html#g-message">g_message</a></span> <span class="gtkdoc opt">(</span><span class="string">&quot;Cursor example started in locale: %s&quot;</span><span class="gtkdoc opt">,</span>
     <span class="function"><a href="eds-EBookClient.html#e-book-client-get-locale">e_book_client_get_locale</a></span> <span class="gtkdoc opt">(</span>priv<span class="gtkdoc opt">-&gt;</span>client<span class="gtkdoc opt">));</span>

  <span class="keyword">return</span> <span class="gtkdoc opt">(</span>GtkWidget <span class="gtkdoc opt">*)</span> example<span class="gtkdoc opt">;</span>
<span class="gtkdoc opt">}</span></pre></td>
      </tr>
    </tbody>
  </table>
</div>

</div>
<div class="refsect1">
<a name="id-1.6.2.5"></a><h2>The alphabetic navigator</h2>
<p>
      This is a simple class which implements a vertical scroller and displays
      various letters according to the currently active alphabet. The actual
      interaction with <a class="link" href="eds-EBookClientCursor.html#EBookClientCursor" title="struct EBookClientCursor"><span class="type">EBookClientCursor</span></a> is done in the main contact browser
      and this class is simply configured with the active alphabet.
    </p>
<div class="informalexample">
  <table class="listing_frame" border="0" cellpadding="0" cellspacing="0">
    <tbody>
      <tr>
        <td class="listing_lines" align="right"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257</pre></td>
        <td class="listing_code"><pre class="programlisting"><span class="comment">/* -*- Mode: C; tab-width: 8; indent-tabs-mode: t; c-basic-offset: 8 -*- */</span>
<span class="comment">/*</span>
<span class="comment"> * Copyright (C) 2013 Intel Corporation</span>
<span class="comment"> *</span>
<span class="comment"> * This library is free software you can redistribute it and/or modify it</span>
<span class="comment"> * under the terms of the GNU Lesser General Public License as published by</span>
<span class="comment"> * the Free Software Foundation.</span>
<span class="comment"> *</span>
<span class="comment"> * This library is distributed in the hope that it will be useful, but</span>
<span class="comment"> * WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY</span>
<span class="comment"> * or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License</span>
<span class="comment"> * for more details.</span>
<span class="comment"> *</span>
<span class="comment"> * You should have received a copy of the GNU Lesser General Public License</span>
<span class="comment"> * along with this library; if not, see &lt;http://www.gnu.org/licenses/&gt;.</span>
<span class="comment"> *</span>
<span class="comment"> * Author: Tristan Van Berkom &lt;tristanvb&#64;openismus.com&gt;</span>
<span class="comment"> */</span>

<span class="gtkdoc ppc">#include</span> <span class="gtkdoc pps">&quot;cursor-navigator.h&quot;</span><span class="gtkdoc ppc"></span>

<span class="comment">/* GObjectClass */</span>
<span class="gtkdoc kwb">static void</span>            <span class="function">cursor_navigator_constructed</span>     <span class="gtkdoc opt">(</span>GObject              <span class="gtkdoc opt">*</span>object<span class="gtkdoc opt">);</span>
<span class="gtkdoc kwb">static void</span>            <span class="function">cursor_navigator_finalize</span>        <span class="gtkdoc opt">(</span>GObject              <span class="gtkdoc opt">*</span>object<span class="gtkdoc opt">);</span>

<span class="comment">/* GtkScaleClass */</span>
<span class="gtkdoc kwb">static</span> gchar          <span class="gtkdoc opt">*</span><span class="function">cursor_navigator_format_value</span>    <span class="gtkdoc opt">(</span>GtkScale             <span class="gtkdoc opt">*</span>scale<span class="gtkdoc opt">,</span>
						 gdouble               value<span class="gtkdoc opt">);</span>

<span class="gtkdoc kwb">static void</span>            <span class="function">cursor_navigator_changed</span>         <span class="gtkdoc opt">(</span>GtkAdjustment        <span class="gtkdoc opt">*</span>adj<span class="gtkdoc opt">,</span>
						 GParamSpec           <span class="gtkdoc opt">*</span>pspec<span class="gtkdoc opt">,</span>
						 CursorNavigator      <span class="gtkdoc opt">*</span>navigator<span class="gtkdoc opt">);</span>

<span class="gtkdoc kwb">struct</span> _CursorNavigatorPrivate <span class="gtkdoc opt">{</span>
gchar <span class="gtkdoc opt">**</span>alphabet<span class="gtkdoc opt">;</span>
gint    letters<span class="gtkdoc opt">;</span>
gint    index<span class="gtkdoc opt">;</span>
<span class="gtkdoc opt">};</span>

<span class="gtkdoc kwb">enum</span> <span class="gtkdoc opt">{</span>
INDEX_CHANGED<span class="gtkdoc opt">,</span>
LAST_SIGNAL
<span class="gtkdoc opt">};</span>

<span class="gtkdoc kwb">static</span> guint signals<span class="gtkdoc opt">[</span>LAST_SIGNAL<span class="gtkdoc opt">];</span>

<span class="gtkdoc kwb">enum</span> <span class="gtkdoc opt">{</span>
PROP_0<span class="gtkdoc opt">,</span>
PROP_INDEX<span class="gtkdoc opt">,</span>
<span class="gtkdoc opt">};</span>

<span class="function"><a href="https://developer.gnome.org/gobject/unstable/gobject-Type-Information.html#G-DEFINE-TYPE:CAPS">G_DEFINE_TYPE</a></span> <span class="gtkdoc opt">(</span>CursorNavigator<span class="gtkdoc opt">,</span> cursor_navigator<span class="gtkdoc opt">,</span> GTK_TYPE_SCALE<span class="gtkdoc opt">);</span>

<span class="comment">/************************************************************************</span>
<span class="comment"> *                          GObjectClass                                *</span>
<span class="comment"> ************************************************************************/</span>
<span class="gtkdoc kwb">static void</span>
<span class="function">cursor_navigator_class_init</span> <span class="gtkdoc opt">(</span>CursorNavigatorClass <span class="gtkdoc opt">*</span>klass<span class="gtkdoc opt">)</span>
<span class="gtkdoc opt">{</span>
GObjectClass       <span class="gtkdoc opt">*</span>object_class<span class="gtkdoc opt">;</span>
GtkScaleClass      <span class="gtkdoc opt">*</span>scale_class<span class="gtkdoc opt">;</span>

object_class <span class="gtkdoc opt">=</span> <span class="function"><a href="https://developer.gnome.org/gobject/unstable/gobject-The-Base-Object-Type.html#G-OBJECT-CLASS:CAPS">G_OBJECT_CLASS</a></span> <span class="gtkdoc opt">(</span>klass<span class="gtkdoc opt">);</span>
object_class<span class="gtkdoc opt">-&gt;</span>constructed <span class="gtkdoc opt">=</span> cursor_navigator_constructed<span class="gtkdoc opt">;</span>
object_class<span class="gtkdoc opt">-&gt;</span>finalize <span class="gtkdoc opt">=</span> cursor_navigator_finalize<span class="gtkdoc opt">;</span>

scale_class <span class="gtkdoc opt">=</span> <span class="function">GTK_SCALE_CLASS</span> <span class="gtkdoc opt">(</span>klass<span class="gtkdoc opt">);</span>
scale_class<span class="gtkdoc opt">-&gt;</span>format_value <span class="gtkdoc opt">=</span> cursor_navigator_format_value<span class="gtkdoc opt">;</span>

signals<span class="gtkdoc opt">[</span>INDEX_CHANGED<span class="gtkdoc opt">] =</span> <span class="function"><a href="https://developer.gnome.org/gobject/unstable/gobject-Signals.html#g-signal-new">g_signal_new</a></span> <span class="gtkdoc opt">(</span>
	<span class="string">&quot;index-changed&quot;</span><span class="gtkdoc opt">,</span>
	<span class="function"><a href="https://developer.gnome.org/gobject/unstable/gobject-The-Base-Object-Type.html#G-OBJECT-CLASS-TYPE:CAPS">G_OBJECT_CLASS_TYPE</a></span> <span class="gtkdoc opt">(</span>object_class<span class="gtkdoc opt">),</span>
	G_SIGNAL_RUN_LAST<span class="gtkdoc opt">,</span>
	<span class="number">0</span><span class="gtkdoc opt">,</span> NULL<span class="gtkdoc opt">,</span> NULL<span class="gtkdoc opt">,</span> NULL<span class="gtkdoc opt">,</span>
	G_TYPE_NONE<span class="gtkdoc opt">,</span> <span class="number">0</span><span class="gtkdoc opt">);</span>

<span class="function"><a href="https://developer.gnome.org/gobject/unstable/gobject-Type-Information.html#g-type-class-add-private">g_type_class_add_private</a></span> <span class="gtkdoc opt">(</span>object_class<span class="gtkdoc opt">,</span> <span class="keyword">sizeof</span> <span class="gtkdoc opt">(</span>CursorNavigatorPrivate<span class="gtkdoc opt">));</span>
<span class="gtkdoc opt">}</span>

<span class="gtkdoc kwb">static void</span>
<span class="function">cursor_navigator_init</span> <span class="gtkdoc opt">(</span>CursorNavigator <span class="gtkdoc opt">*</span>navigator<span class="gtkdoc opt">)</span>
<span class="gtkdoc opt">{</span>
CursorNavigatorPrivate <span class="gtkdoc opt">*</span>priv<span class="gtkdoc opt">;</span>

navigator<span class="gtkdoc opt">-&gt;</span>priv <span class="gtkdoc opt">=</span> priv <span class="gtkdoc opt">=</span>
	<span class="function"><a href="https://developer.gnome.org/gobject/unstable/gobject-Type-Information.html#G-TYPE-INSTANCE-GET-PRIVATE:CAPS">G_TYPE_INSTANCE_GET_PRIVATE</a></span> <span class="gtkdoc opt">(</span>
		navigator<span class="gtkdoc opt">,</span>
		CURSOR_TYPE_NAVIGATOR<span class="gtkdoc opt">,</span>
		CursorNavigatorPrivate<span class="gtkdoc opt">);</span>

priv<span class="gtkdoc opt">-&gt;</span>letters <span class="gtkdoc opt">= -</span><span class="number">1</span><span class="gtkdoc opt">;</span>
<span class="gtkdoc opt">}</span>

<span class="gtkdoc kwb">static void</span>
<span class="function">cursor_navigator_constructed</span> <span class="gtkdoc opt">(</span>GObject <span class="gtkdoc opt">*</span>object<span class="gtkdoc opt">)</span>
<span class="gtkdoc opt">{</span>
CursorNavigator        <span class="gtkdoc opt">*</span>navigator <span class="gtkdoc opt">=</span> <span class="function">CURSOR_NAVIGATOR</span> <span class="gtkdoc opt">(</span>object<span class="gtkdoc opt">);</span>
GtkAdjustment          <span class="gtkdoc opt">*</span>adj <span class="gtkdoc opt">=</span> NULL<span class="gtkdoc opt">;</span>

<span class="function"><a href="https://developer.gnome.org/gobject/unstable/gobject-The-Base-Object-Type.html#G-OBJECT-CLASS:CAPS">G_OBJECT_CLASS</a></span> <span class="gtkdoc opt">(</span>cursor_navigator_parent_class<span class="gtkdoc opt">)-&gt;</span><span class="function">constructed</span> <span class="gtkdoc opt">(</span>object<span class="gtkdoc opt">);</span>

adj <span class="gtkdoc opt">=</span> <span class="function"><a href="http://developer.gnome.org/gtk2/GtkAdjustment.html#gtk-adjustment-new">gtk_adjustment_new</a></span> <span class="gtkdoc opt">(</span><span class="number">0.0</span>F<span class="gtkdoc opt">,</span> <span class="number">0.0</span>F<span class="gtkdoc opt">,</span> <span class="number">1.0</span>F<span class="gtkdoc opt">,</span> <span class="number">1.0</span>F<span class="gtkdoc opt">,</span> <span class="number">1.0</span>F<span class="gtkdoc opt">,</span> <span class="number">0.0</span>F<span class="gtkdoc opt">);</span>
<span class="function"><a href="http://developer.gnome.org/gtk2/GtkRange.html#gtk-range-set-adjustment">gtk_range_set_adjustment</a></span> <span class="gtkdoc opt">(</span><span class="function">GTK_RANGE</span> <span class="gtkdoc opt">(</span>navigator<span class="gtkdoc opt">),</span> adj<span class="gtkdoc opt">);</span>

<span class="function"><a href="https://developer.gnome.org/gobject/unstable/gobject-Signals.html#g-signal-connect">g_signal_connect</a></span> <span class="gtkdoc opt">(</span>
	adj<span class="gtkdoc opt">,</span> <span class="string">&quot;notify::value&quot;</span><span class="gtkdoc opt">,</span>
	<span class="function"><a href="https://developer.gnome.org/gobject/unstable/gobject-Closures.html#G-CALLBACK:CAPS">G_CALLBACK</a></span> <span class="gtkdoc opt">(</span>cursor_navigator_changed<span class="gtkdoc opt">),</span> navigator<span class="gtkdoc opt">);</span>
<span class="gtkdoc opt">}</span>

<span class="gtkdoc kwb">static void</span>
<span class="function">cursor_navigator_finalize</span> <span class="gtkdoc opt">(</span>GObject <span class="gtkdoc opt">*</span>object<span class="gtkdoc opt">)</span>
<span class="gtkdoc opt">{</span>
CursorNavigator        <span class="gtkdoc opt">*</span>navigator <span class="gtkdoc opt">=</span> <span class="function">CURSOR_NAVIGATOR</span> <span class="gtkdoc opt">(</span>object<span class="gtkdoc opt">);</span>
CursorNavigatorPrivate <span class="gtkdoc opt">*</span>priv <span class="gtkdoc opt">=</span> navigator<span class="gtkdoc opt">-&gt;</span>priv<span class="gtkdoc opt">;</span>

<span class="function"><a href="https://developer.gnome.org/glib/unstable/glib-String-Utility-Functions.html#g-strfreev">g_strfreev</a></span> <span class="gtkdoc opt">(</span>priv<span class="gtkdoc opt">-&gt;</span>alphabet<span class="gtkdoc opt">);</span>

<span class="function"><a href="https://developer.gnome.org/gobject/unstable/gobject-The-Base-Object-Type.html#G-OBJECT-CLASS:CAPS">G_OBJECT_CLASS</a></span> <span class="gtkdoc opt">(</span>cursor_navigator_parent_class<span class="gtkdoc opt">)-&gt;</span><span class="function">finalize</span> <span class="gtkdoc opt">(</span>object<span class="gtkdoc opt">);</span>
<span class="gtkdoc opt">}</span>

<span class="comment">/************************************************************************</span>
<span class="comment"> *                          GtkScaleClass                               *</span>
<span class="comment"> ************************************************************************/</span>
<span class="gtkdoc kwb">static</span> gchar <span class="gtkdoc opt">*</span>
<span class="function">cursor_navigator_format_value</span> <span class="gtkdoc opt">(</span>GtkScale <span class="gtkdoc opt">*</span>scale<span class="gtkdoc opt">,</span>
                               gdouble value<span class="gtkdoc opt">)</span>
<span class="gtkdoc opt">{</span>
CursorNavigator        <span class="gtkdoc opt">*</span>navigator <span class="gtkdoc opt">=</span> <span class="function">CURSOR_NAVIGATOR</span> <span class="gtkdoc opt">(</span>scale<span class="gtkdoc opt">);</span>
CursorNavigatorPrivate <span class="gtkdoc opt">*</span>priv <span class="gtkdoc opt">=</span> navigator<span class="gtkdoc opt">-&gt;</span>priv<span class="gtkdoc opt">;</span>
gint                    index<span class="gtkdoc opt">;</span>

<span class="keyword">if</span> <span class="gtkdoc opt">(</span>priv<span class="gtkdoc opt">-&gt;</span>letters <span class="gtkdoc opt">&lt;</span> <span class="number">0</span><span class="gtkdoc opt">)</span>
	<span class="keyword">return</span> NULL<span class="gtkdoc opt">;</span>

index <span class="gtkdoc opt">=</span> <span class="function"><a href="https://developer.gnome.org/glib/unstable/glib-Standard-Macros.html#CLAMP:CAPS">CLAMP</a></span> <span class="gtkdoc opt">((</span>gint<span class="gtkdoc opt">)</span> value<span class="gtkdoc opt">,</span> <span class="number">0</span><span class="gtkdoc opt">,</span> priv<span class="gtkdoc opt">-&gt;</span>letters <span class="gtkdoc opt">-</span> <span class="number">1</span><span class="gtkdoc opt">);</span>

<span class="comment">/* Return the letter for the gvoidiven value</span>
<span class="comment"> */</span>
<span class="keyword">return</span> <span class="function"><a href="https://developer.gnome.org/glib/unstable/glib-String-Utility-Functions.html#g-strdup">g_strdup</a></span> <span class="gtkdoc opt">(</span>priv<span class="gtkdoc opt">-&gt;</span>alphabet<span class="gtkdoc opt">[</span>index<span class="gtkdoc opt">]);</span>
<span class="gtkdoc opt">}</span>

<span class="gtkdoc kwb">static void</span>
<span class="function">cursor_navigator_changed</span> <span class="gtkdoc opt">(</span>GtkAdjustment <span class="gtkdoc opt">*</span>adj<span class="gtkdoc opt">,</span>
                          GParamSpec <span class="gtkdoc opt">*</span>pspec<span class="gtkdoc opt">,</span>
                          CursorNavigator <span class="gtkdoc opt">*</span>navigator<span class="gtkdoc opt">)</span>
<span class="gtkdoc opt">{</span>
gint index <span class="gtkdoc opt">=</span> <span class="function"><a href="http://developer.gnome.org/gtk2/GtkAdjustment.html#gtk-adjustment-get-value">gtk_adjustment_get_value</a></span> <span class="gtkdoc opt">(</span>adj<span class="gtkdoc opt">);</span>

<span class="function">cursor_navigator_set_index</span> <span class="gtkdoc opt">(</span>navigator<span class="gtkdoc opt">,</span> index<span class="gtkdoc opt">);</span>
<span class="gtkdoc opt">}</span>

<span class="comment">/************************************************************************</span>
<span class="comment"> *                                API                                   *</span>
<span class="comment"> ************************************************************************/</span>
CursorNavigator <span class="gtkdoc opt">*</span>
<span class="function">cursor_navigator_new</span> <span class="gtkdoc opt">(</span><span class="gtkdoc kwb">void</span><span class="gtkdoc opt">)</span>
<span class="gtkdoc opt">{</span>
<span class="keyword">return</span> <span class="function"><a href="https://developer.gnome.org/gobject/unstable/gobject-The-Base-Object-Type.html#g-object-new">g_object_new</a></span> <span class="gtkdoc opt">(</span>CURSOR_TYPE_NAVIGATOR<span class="gtkdoc opt">,</span> NULL<span class="gtkdoc opt">);</span>
<span class="gtkdoc opt">}</span>

<span class="gtkdoc kwb">static void</span>
<span class="function">cursor_navigator_update_parameters</span> <span class="gtkdoc opt">(</span>CursorNavigator <span class="gtkdoc opt">*</span>navigator<span class="gtkdoc opt">)</span>
<span class="gtkdoc opt">{</span>
CursorNavigatorPrivate <span class="gtkdoc opt">*</span>priv <span class="gtkdoc opt">=</span> navigator<span class="gtkdoc opt">-&gt;</span>priv<span class="gtkdoc opt">;</span>
GtkScale               <span class="gtkdoc opt">*</span>scale <span class="gtkdoc opt">=</span> <span class="function">GTK_SCALE</span> <span class="gtkdoc opt">(</span>navigator<span class="gtkdoc opt">);</span>
GtkAdjustment          <span class="gtkdoc opt">*</span>adj<span class="gtkdoc opt">;</span>
gint                    i<span class="gtkdoc opt">;</span>

<span class="function"><a href="http://developer.gnome.org/gtk2/GtkScale.html#gtk-scale-clear-marks">gtk_scale_clear_marks</a></span> <span class="gtkdoc opt">(</span>scale<span class="gtkdoc opt">);</span>
<span class="keyword">for</span> <span class="gtkdoc opt">(</span>i <span class="gtkdoc opt">=</span> <span class="number">0</span><span class="gtkdoc opt">;</span> i <span class="gtkdoc opt">&lt;</span> priv<span class="gtkdoc opt">-&gt;</span>letters<span class="gtkdoc opt">;</span> i<span class="gtkdoc opt">++) {</span>
	gchar <span class="gtkdoc opt">*</span>letter<span class="gtkdoc opt">;</span>

	letter <span class="gtkdoc opt">=</span> <span class="function"><a href="https://developer.gnome.org/glib/unstable/glib-String-Utility-Functions.html#g-strdup-printf">g_strdup_printf</a></span> <span class="gtkdoc opt">(</span><span class="string">&quot;&lt;span size=</span><span class="gtkdoc esc">\&quot;</span><span class="string">x-small</span><span class="gtkdoc esc">\&quot;</span><span class="string">&gt;%s&lt;/span&gt;&quot;</span><span class="gtkdoc opt">,</span> priv<span class="gtkdoc opt">-&gt;</span>alphabet<span class="gtkdoc opt">[</span>i<span class="gtkdoc opt">]);</span>

	<span class="function"><a href="http://developer.gnome.org/gtk2/GtkScale.html#gtk-scale-add-mark">gtk_scale_add_mark</a></span> <span class="gtkdoc opt">(</span>scale<span class="gtkdoc opt">,</span> i<span class="gtkdoc opt">,</span> GTK_POS_LEFT<span class="gtkdoc opt">,</span> letter<span class="gtkdoc opt">);</span>
	<span class="function"><a href="https://developer.gnome.org/glib/unstable/glib-Memory-Allocation.html#g-free">g_free</a></span> <span class="gtkdoc opt">(</span>letter<span class="gtkdoc opt">);</span>
<span class="gtkdoc opt">}</span>

adj <span class="gtkdoc opt">=</span> <span class="function"><a href="http://developer.gnome.org/gtk2/GtkRange.html#gtk-range-get-adjustment">gtk_range_get_adjustment</a></span> <span class="gtkdoc opt">(</span><span class="function">GTK_RANGE</span> <span class="gtkdoc opt">(</span>navigator<span class="gtkdoc opt">));</span>

<span class="function"><a href="http://developer.gnome.org/gtk2/GtkAdjustment.html#gtk-adjustment-set-upper">gtk_adjustment_set_upper</a></span> <span class="gtkdoc opt">(</span>adj<span class="gtkdoc opt">,</span> priv<span class="gtkdoc opt">-&gt;</span>letters <span class="gtkdoc opt">-</span> <span class="number">1</span><span class="gtkdoc opt">);</span>
<span class="gtkdoc opt">}</span>

<span class="gtkdoc kwb">void</span>
<span class="function">cursor_navigator_set_alphabet</span> <span class="gtkdoc opt">(</span>CursorNavigator <span class="gtkdoc opt">*</span>navigator<span class="gtkdoc opt">,</span>
                               <span class="gtkdoc kwb">const</span> gchar <span class="gtkdoc opt">*</span> <span class="gtkdoc kwb">const</span> <span class="gtkdoc opt">*</span>alphabet<span class="gtkdoc opt">)</span>
<span class="gtkdoc opt">{</span>
CursorNavigatorPrivate <span class="gtkdoc opt">*</span>priv<span class="gtkdoc opt">;</span>

<span class="function"><a href="https://developer.gnome.org/glib/unstable/glib-Warnings-and-Assertions.html#g-return-if-fail">g_return_if_fail</a></span> <span class="gtkdoc opt">(</span><span class="function">CURSOR_IS_NAVIGATOR</span> <span class="gtkdoc opt">(</span>navigator<span class="gtkdoc opt">));</span>
<span class="function"><a href="https://developer.gnome.org/glib/unstable/glib-Warnings-and-Assertions.html#g-return-if-fail">g_return_if_fail</a></span> <span class="gtkdoc opt">(</span>alphabet <span class="gtkdoc opt">==</span> NULL <span class="gtkdoc opt">||</span>
		  <span class="function"><a href="https://developer.gnome.org/glib/unstable/glib-String-Utility-Functions.html#g-strv-length">g_strv_length</a></span> <span class="gtkdoc opt">((</span>gchar <span class="gtkdoc opt">**)</span> alphabet<span class="gtkdoc opt">) &gt;</span> <span class="number">0</span><span class="gtkdoc opt">);</span>

priv <span class="gtkdoc opt">=</span> navigator<span class="gtkdoc opt">-&gt;</span>priv<span class="gtkdoc opt">;</span>

<span class="function"><a href="https://developer.gnome.org/glib/unstable/glib-Memory-Allocation.html#g-free">g_free</a></span> <span class="gtkdoc opt">(</span>priv<span class="gtkdoc opt">-&gt;</span>alphabet<span class="gtkdoc opt">);</span>
<span class="keyword">if</span> <span class="gtkdoc opt">(</span>alphabet<span class="gtkdoc opt">) {</span>
	priv<span class="gtkdoc opt">-&gt;</span>alphabet <span class="gtkdoc opt">=</span> <span class="function"><a href="https://developer.gnome.org/glib/unstable/glib-String-Utility-Functions.html#g-strdupv">g_strdupv</a></span> <span class="gtkdoc opt">((</span>gchar <span class="gtkdoc opt">**)</span> alphabet<span class="gtkdoc opt">);</span>
	priv<span class="gtkdoc opt">-&gt;</span>letters <span class="gtkdoc opt">=</span> <span class="function"><a href="https://developer.gnome.org/glib/unstable/glib-String-Utility-Functions.html#g-strv-length">g_strv_length</a></span> <span class="gtkdoc opt">((</span>gchar <span class="gtkdoc opt">**)</span> alphabet<span class="gtkdoc opt">);</span>
<span class="gtkdoc opt">}</span> <span class="keyword">else</span> <span class="gtkdoc opt">{</span>
	priv<span class="gtkdoc opt">-&gt;</span>alphabet <span class="gtkdoc opt">=</span> NULL<span class="gtkdoc opt">;</span>
	priv<span class="gtkdoc opt">-&gt;</span>letters <span class="gtkdoc opt">= -</span><span class="number">1</span><span class="gtkdoc opt">;</span>
<span class="gtkdoc opt">}</span>

<span class="function">cursor_navigator_update_parameters</span> <span class="gtkdoc opt">(</span>navigator<span class="gtkdoc opt">);</span>
<span class="function">cursor_navigator_set_index</span> <span class="gtkdoc opt">(</span>navigator<span class="gtkdoc opt">,</span> <span class="number">0</span><span class="gtkdoc opt">);</span>
<span class="gtkdoc opt">}</span>

<span class="gtkdoc kwb">const</span> gchar <span class="gtkdoc opt">*</span> <span class="gtkdoc kwb">const</span> <span class="gtkdoc opt">*</span>
<span class="function">cursor_navigator_get_alphabet</span> <span class="gtkdoc opt">(</span>CursorNavigator <span class="gtkdoc opt">*</span>navigator<span class="gtkdoc opt">)</span>
<span class="gtkdoc opt">{</span>
CursorNavigatorPrivate <span class="gtkdoc opt">*</span>priv<span class="gtkdoc opt">;</span>

<span class="function"><a href="https://developer.gnome.org/glib/unstable/glib-Warnings-and-Assertions.html#g-return-val-if-fail">g_return_val_if_fail</a></span> <span class="gtkdoc opt">(</span><span class="function">CURSOR_IS_NAVIGATOR</span> <span class="gtkdoc opt">(</span>navigator<span class="gtkdoc opt">),</span> NULL<span class="gtkdoc opt">);</span>

priv <span class="gtkdoc opt">=</span> navigator<span class="gtkdoc opt">-&gt;</span>priv<span class="gtkdoc opt">;</span>

<span class="keyword">return</span> <span class="gtkdoc opt">(</span><span class="gtkdoc kwb">const</span> gchar <span class="gtkdoc opt">*</span> <span class="gtkdoc kwb">const</span> <span class="gtkdoc opt">*)</span> priv<span class="gtkdoc opt">-&gt;</span>alphabet<span class="gtkdoc opt">;</span>
<span class="gtkdoc opt">}</span>

<span class="gtkdoc kwb">void</span>
<span class="function">cursor_navigator_set_index</span> <span class="gtkdoc opt">(</span>CursorNavigator <span class="gtkdoc opt">*</span>navigator<span class="gtkdoc opt">,</span>
                            gint index<span class="gtkdoc opt">)</span>
<span class="gtkdoc opt">{</span>
CursorNavigatorPrivate <span class="gtkdoc opt">*</span>priv<span class="gtkdoc opt">;</span>
GtkAdjustment          <span class="gtkdoc opt">*</span>adj<span class="gtkdoc opt">;</span>

<span class="function"><a href="https://developer.gnome.org/glib/unstable/glib-Warnings-and-Assertions.html#g-return-if-fail">g_return_if_fail</a></span> <span class="gtkdoc opt">(</span><span class="function">CURSOR_IS_NAVIGATOR</span> <span class="gtkdoc opt">(</span>navigator<span class="gtkdoc opt">));</span>

priv <span class="gtkdoc opt">=</span> navigator<span class="gtkdoc opt">-&gt;</span>priv<span class="gtkdoc opt">;</span>
adj <span class="gtkdoc opt">=</span> <span class="function"><a href="http://developer.gnome.org/gtk2/GtkRange.html#gtk-range-get-adjustment">gtk_range_get_adjustment</a></span> <span class="gtkdoc opt">(</span><span class="function">GTK_RANGE</span> <span class="gtkdoc opt">(</span>navigator<span class="gtkdoc opt">));</span>

index <span class="gtkdoc opt">=</span> <span class="function"><a href="https://developer.gnome.org/glib/unstable/glib-Standard-Macros.html#CLAMP:CAPS">CLAMP</a></span> <span class="gtkdoc opt">(</span>index<span class="gtkdoc opt">,</span> <span class="number">0</span><span class="gtkdoc opt">,</span> priv<span class="gtkdoc opt">-&gt;</span>letters<span class="gtkdoc opt">);</span>

<span class="keyword">if</span> <span class="gtkdoc opt">(</span>priv<span class="gtkdoc opt">-&gt;</span>index <span class="gtkdoc opt">!=</span> index<span class="gtkdoc opt">) {</span>

	priv<span class="gtkdoc opt">-&gt;</span>index <span class="gtkdoc opt">=</span> index<span class="gtkdoc opt">;</span>

	<span class="function"><a href="https://developer.gnome.org/gobject/unstable/gobject-Signals.html#g-signal-emit">g_signal_emit</a></span> <span class="gtkdoc opt">(</span>navigator<span class="gtkdoc opt">,</span> signals<span class="gtkdoc opt">[</span>INDEX_CHANGED<span class="gtkdoc opt">],</span> <span class="number">0</span><span class="gtkdoc opt">);</span>

	<span class="function"><a href="https://developer.gnome.org/gobject/unstable/gobject-Signals.html#g-signal-handlers-block-by-func">g_signal_handlers_block_by_func</a></span> <span class="gtkdoc opt">(</span>adj<span class="gtkdoc opt">,</span> cursor_navigator_changed<span class="gtkdoc opt">,</span> navigator<span class="gtkdoc opt">);</span>
	<span class="function"><a href="http://developer.gnome.org/gtk2/GtkAdjustment.html#gtk-adjustment-set-value">gtk_adjustment_set_value</a></span> <span class="gtkdoc opt">(</span>adj<span class="gtkdoc opt">,</span> priv<span class="gtkdoc opt">-&gt;</span>index<span class="gtkdoc opt">);</span>
	<span class="function"><a href="https://developer.gnome.org/gobject/unstable/gobject-Signals.html#g-signal-handlers-unblock-by-func">g_signal_handlers_unblock_by_func</a></span> <span class="gtkdoc opt">(</span>adj<span class="gtkdoc opt">,</span> cursor_navigator_changed<span class="gtkdoc opt">,</span> navigator<span class="gtkdoc opt">);</span>
<span class="gtkdoc opt">}</span>
<span class="gtkdoc opt">}</span>

gint
<span class="function">cursor_navigator_get_index</span> <span class="gtkdoc opt">(</span>CursorNavigator <span class="gtkdoc opt">*</span>navigator<span class="gtkdoc opt">)</span>
<span class="gtkdoc opt">{</span>
CursorNavigatorPrivate <span class="gtkdoc opt">*</span>priv<span class="gtkdoc opt">;</span>

<span class="function"><a href="https://developer.gnome.org/glib/unstable/glib-Warnings-and-Assertions.html#g-return-val-if-fail">g_return_val_if_fail</a></span> <span class="gtkdoc opt">(</span><span class="function">CURSOR_IS_NAVIGATOR</span> <span class="gtkdoc opt">(</span>navigator<span class="gtkdoc opt">),</span> <span class="number">0</span><span class="gtkdoc opt">);</span>

priv <span class="gtkdoc opt">=</span> navigator<span class="gtkdoc opt">-&gt;</span>priv<span class="gtkdoc opt">;</span>

<span class="keyword">return</span> priv<span class="gtkdoc opt">-&gt;</span>index<span class="gtkdoc opt">;</span>
<span class="gtkdoc opt">}</span></pre></td>
      </tr>
    </tbody>
  </table>
</div>

</div>
<div class="refsect1">
<a name="id-1.6.2.6"></a><h2>The search entry</h2>
<p>
      The search entry is placed at the top of the contacts browser,
      this class simply implements a drop down box choosing the appropriate
      search expression which should be used to filter the contacts
      in the browser display window.
    </p>
<div class="informalexample">
  <table class="listing_frame" border="0" cellpadding="0" cellspacing="0">
    <tbody>
      <tr>
        <td class="listing_lines" align="right"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253</pre></td>
        <td class="listing_code"><pre class="programlisting"><span class="comment">/* -*- Mode: C; tab-width: 8; indent-tabs-mode: t; c-basic-offset: 8 -*- */</span>
<span class="comment">/*</span>
<span class="comment"> * Copyright (C) 2013 Intel Corporation</span>
<span class="comment"> *</span>
<span class="comment"> * This library is free software you can redistribute it and/or modify it</span>
<span class="comment"> * under the terms of the GNU Lesser General Public License as published by</span>
<span class="comment"> * the Free Software Foundation.</span>
<span class="comment"> *</span>
<span class="comment"> * This library is distributed in the hope that it will be useful, but</span>
<span class="comment"> * WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY</span>
<span class="comment"> * or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License</span>
<span class="comment"> * for more details.</span>
<span class="comment"> *</span>
<span class="comment"> * You should have received a copy of the GNU Lesser General Public License</span>
<span class="comment"> * along with this library; if not, see &lt;http://www.gnu.org/licenses/&gt;.</span>
<span class="comment"> *</span>
<span class="comment"> * Author: Tristan Van Berkom &lt;tristanvb&#64;openismus.com&gt;</span>
<span class="comment"> */</span>

<span class="gtkdoc ppc">#include &lt;libebook/libebook.h&gt;</span>

<span class="gtkdoc ppc">#include</span> <span class="gtkdoc pps">&quot;cursor-search.h&quot;</span><span class="gtkdoc ppc"></span>

<span class="comment">/* GObjectClass */</span>
<span class="gtkdoc kwb">static void</span>  <span class="function">cursor_search_finalize</span>       <span class="gtkdoc opt">(</span>GObject           <span class="gtkdoc opt">*</span>object<span class="gtkdoc opt">);</span>
<span class="gtkdoc kwb">static void</span>  <span class="function">cursor_search_get_property</span>   <span class="gtkdoc opt">(</span>GObject           <span class="gtkdoc opt">*</span>object<span class="gtkdoc opt">,</span>
				   guint              property_id<span class="gtkdoc opt">,</span>
				   GValue            <span class="gtkdoc opt">*</span>value<span class="gtkdoc opt">,</span>
				   GParamSpec        <span class="gtkdoc opt">*</span>pspec<span class="gtkdoc opt">);</span>

<span class="comment">/* UI Callbacks */</span>
<span class="gtkdoc kwb">static void</span>  <span class="function">cursor_search_option_toggled</span> <span class="gtkdoc opt">(</span>CursorSearch         <span class="gtkdoc opt">*</span>search<span class="gtkdoc opt">,</span>
				   GtkWidget            <span class="gtkdoc opt">*</span>item<span class="gtkdoc opt">);</span>
<span class="gtkdoc kwb">static void</span>  <span class="function">cursor_search_entry_changed</span>  <span class="gtkdoc opt">(</span>CursorSearch         <span class="gtkdoc opt">*</span>search<span class="gtkdoc opt">,</span>
				   GtkEditable          <span class="gtkdoc opt">*</span>entry<span class="gtkdoc opt">);</span>
<span class="gtkdoc kwb">static void</span>  <span class="function">cursor_search_icon_press</span>     <span class="gtkdoc opt">(</span>CursorSearch         <span class="gtkdoc opt">*</span>search<span class="gtkdoc opt">,</span>
				   GtkEntryIconPosition  icon_pos<span class="gtkdoc opt">,</span>
				   GdkEvent             <span class="gtkdoc opt">*</span>event<span class="gtkdoc opt">,</span>
				   GtkEntry             <span class="gtkdoc opt">*</span>entry<span class="gtkdoc opt">);</span>

<span class="gtkdoc kwc">typedef</span> <span class="gtkdoc kwb">enum</span> <span class="gtkdoc opt">{</span>
SEARCH_NAME<span class="gtkdoc opt">,</span>
SEARCH_PHONE<span class="gtkdoc opt">,</span>
SEARCH_EMAIL
<span class="gtkdoc opt">}</span> SearchType<span class="gtkdoc opt">;</span>

<span class="gtkdoc kwb">struct</span> _CursorSearchPrivate <span class="gtkdoc opt">{</span>
GtkWidget   <span class="gtkdoc opt">*</span>popup<span class="gtkdoc opt">;</span>
GtkWidget   <span class="gtkdoc opt">*</span>name_radio<span class="gtkdoc opt">;</span>
GtkWidget   <span class="gtkdoc opt">*</span>phone_radio<span class="gtkdoc opt">;</span>
GtkWidget   <span class="gtkdoc opt">*</span>email_radio<span class="gtkdoc opt">;</span>

SearchType   type<span class="gtkdoc opt">;</span>
gchar       <span class="gtkdoc opt">*</span>sexp<span class="gtkdoc opt">;</span>
<span class="gtkdoc opt">};</span>

<span class="gtkdoc kwb">enum</span> <span class="gtkdoc opt">{</span>
PROP_0<span class="gtkdoc opt">,</span>
PROP_SEXP<span class="gtkdoc opt">,</span>
<span class="gtkdoc opt">};</span>

<span class="function"><a href="https://developer.gnome.org/gobject/unstable/gobject-Type-Information.html#G-DEFINE-TYPE-WITH-PRIVATE:CAPS">G_DEFINE_TYPE_WITH_PRIVATE</a></span> <span class="gtkdoc opt">(</span>CursorSearch<span class="gtkdoc opt">,</span> cursor_search<span class="gtkdoc opt">,</span> GTK_TYPE_SEARCH_ENTRY<span class="gtkdoc opt">);</span>

<span class="comment">/************************************************************************</span>
<span class="comment"> *                          GObjectClass                                *</span>
<span class="comment"> ************************************************************************/</span>
<span class="gtkdoc kwb">static void</span>
<span class="function">cursor_search_class_init</span> <span class="gtkdoc opt">(</span>CursorSearchClass <span class="gtkdoc opt">*</span>klass<span class="gtkdoc opt">)</span>
<span class="gtkdoc opt">{</span>
GObjectClass <span class="gtkdoc opt">*</span>object_class<span class="gtkdoc opt">;</span>
GtkWidgetClass <span class="gtkdoc opt">*</span>widget_class<span class="gtkdoc opt">;</span>

object_class <span class="gtkdoc opt">=</span> <span class="function"><a href="https://developer.gnome.org/gobject/unstable/gobject-The-Base-Object-Type.html#G-OBJECT-CLASS:CAPS">G_OBJECT_CLASS</a></span> <span class="gtkdoc opt">(</span>klass<span class="gtkdoc opt">);</span>
object_class<span class="gtkdoc opt">-&gt;</span>finalize <span class="gtkdoc opt">=</span> cursor_search_finalize<span class="gtkdoc opt">;</span>
object_class<span class="gtkdoc opt">-&gt;</span>get_property <span class="gtkdoc opt">=</span> cursor_search_get_property<span class="gtkdoc opt">;</span>

<span class="function"><a href="https://developer.gnome.org/gobject/unstable/gobject-The-Base-Object-Type.html#g-object-class-install-property">g_object_class_install_property</a></span> <span class="gtkdoc opt">(</span>
	object_class<span class="gtkdoc opt">,</span>
	PROP_SEXP<span class="gtkdoc opt">,</span>
	<span class="function"><a href="https://developer.gnome.org/gobject/unstable/gobject-Standard-Parameter-and-Value-Types.html#g-param-spec-string">g_param_spec_string</a></span> <span class="gtkdoc opt">(</span>
		<span class="string">&quot;sexp&quot;</span><span class="gtkdoc opt">,</span>
		<span class="string">&quot;Search Expression&quot;</span><span class="gtkdoc opt">,</span>
		<span class="string">&quot;The active search expression&quot;</span><span class="gtkdoc opt">,</span>
		NULL<span class="gtkdoc opt">,</span>
		G_PARAM_READABLE <span class="gtkdoc opt">|</span>
		G_PARAM_STATIC_STRINGS<span class="gtkdoc opt">));</span>

<span class="comment">/* Bind to template */</span>
widget_class <span class="gtkdoc opt">=</span> <span class="function">GTK_WIDGET_CLASS</span> <span class="gtkdoc opt">(</span>klass<span class="gtkdoc opt">);</span>
<span class="function"><a href="http://developer.gnome.org/gtk2/GtkWidget.html#gtk-widget-class-set-template-from-resource">gtk_widget_class_set_template_from_resource</a></span> <span class="gtkdoc opt">(</span>widget_class<span class="gtkdoc opt">,</span> <span class="string">&quot;/org/gnome/evolution/cursor-example/cursor-search.ui&quot;</span><span class="gtkdoc opt">);</span>
<span class="function"><a href="http://developer.gnome.org/gtk2/GtkWidget.html#gtk-widget-class-bind-template-child-private">gtk_widget_class_bind_template_child_private</a></span> <span class="gtkdoc opt">(</span>widget_class<span class="gtkdoc opt">,</span> CursorSearch<span class="gtkdoc opt">,</span> popup<span class="gtkdoc opt">);</span>
<span class="function"><a href="http://developer.gnome.org/gtk2/GtkWidget.html#gtk-widget-class-bind-template-child-private">gtk_widget_class_bind_template_child_private</a></span> <span class="gtkdoc opt">(</span>widget_class<span class="gtkdoc opt">,</span> CursorSearch<span class="gtkdoc opt">,</span> name_radio<span class="gtkdoc opt">);</span>
<span class="function"><a href="http://developer.gnome.org/gtk2/GtkWidget.html#gtk-widget-class-bind-template-child-private">gtk_widget_class_bind_template_child_private</a></span> <span class="gtkdoc opt">(</span>widget_class<span class="gtkdoc opt">,</span> CursorSearch<span class="gtkdoc opt">,</span> phone_radio<span class="gtkdoc opt">);</span>
<span class="function"><a href="http://developer.gnome.org/gtk2/GtkWidget.html#gtk-widget-class-bind-template-child-private">gtk_widget_class_bind_template_child_private</a></span> <span class="gtkdoc opt">(</span>widget_class<span class="gtkdoc opt">,</span> CursorSearch<span class="gtkdoc opt">,</span> email_radio<span class="gtkdoc opt">);</span>
<span class="function"><a href="http://developer.gnome.org/gtk2/GtkWidget.html#gtk-widget-class-bind-template-callback">gtk_widget_class_bind_template_callback</a></span> <span class="gtkdoc opt">(</span>widget_class<span class="gtkdoc opt">,</span> cursor_search_option_toggled<span class="gtkdoc opt">);</span>
<span class="function"><a href="http://developer.gnome.org/gtk2/GtkWidget.html#gtk-widget-class-bind-template-callback">gtk_widget_class_bind_template_callback</a></span> <span class="gtkdoc opt">(</span>widget_class<span class="gtkdoc opt">,</span> cursor_search_entry_changed<span class="gtkdoc opt">);</span>
<span class="function"><a href="http://developer.gnome.org/gtk2/GtkWidget.html#gtk-widget-class-bind-template-callback">gtk_widget_class_bind_template_callback</a></span> <span class="gtkdoc opt">(</span>widget_class<span class="gtkdoc opt">,</span> cursor_search_icon_press<span class="gtkdoc opt">);</span>
<span class="gtkdoc opt">}</span>

<span class="gtkdoc kwb">static void</span>
<span class="function">cursor_search_init</span> <span class="gtkdoc opt">(</span>CursorSearch <span class="gtkdoc opt">*</span>search<span class="gtkdoc opt">)</span>
<span class="gtkdoc opt">{</span>
search<span class="gtkdoc opt">-&gt;</span>priv <span class="gtkdoc opt">=</span> <span class="function">cursor_search_get_instance_private</span> <span class="gtkdoc opt">(</span>search<span class="gtkdoc opt">);</span>

<span class="function"><a href="http://developer.gnome.org/gtk2/GtkWidget.html#gtk-widget-init-template">gtk_widget_init_template</a></span> <span class="gtkdoc opt">(</span><span class="function">GTK_WIDGET</span> <span class="gtkdoc opt">(</span>search<span class="gtkdoc opt">));</span>

<span class="function"><a href="https://developer.gnome.org/gobject/unstable/gobject-The-Base-Object-Type.html#g-object-set">g_object_set</a></span> <span class="gtkdoc opt">(</span>
	search<span class="gtkdoc opt">,</span>
	<span class="string">&quot;primary-icon-activatable&quot;</span><span class="gtkdoc opt">,</span> TRUE<span class="gtkdoc opt">,</span>
	<span class="string">&quot;primary-icon-sensitive&quot;</span><span class="gtkdoc opt">,</span> TRUE<span class="gtkdoc opt">,</span>
	NULL<span class="gtkdoc opt">);</span>
<span class="gtkdoc opt">}</span>

<span class="gtkdoc kwb">static void</span>
<span class="function">cursor_search_finalize</span> <span class="gtkdoc opt">(</span>GObject <span class="gtkdoc opt">*</span>object<span class="gtkdoc opt">)</span>
<span class="gtkdoc opt">{</span>
CursorSearch        <span class="gtkdoc opt">*</span>search <span class="gtkdoc opt">=</span> <span class="function">CURSOR_SEARCH</span> <span class="gtkdoc opt">(</span>object<span class="gtkdoc opt">);</span>
CursorSearchPrivate <span class="gtkdoc opt">*</span>priv <span class="gtkdoc opt">=</span> search<span class="gtkdoc opt">-&gt;</span>priv<span class="gtkdoc opt">;</span>

<span class="function"><a href="https://developer.gnome.org/glib/unstable/glib-Memory-Allocation.html#g-free">g_free</a></span> <span class="gtkdoc opt">(</span>priv<span class="gtkdoc opt">-&gt;</span>sexp<span class="gtkdoc opt">);</span>

<span class="function"><a href="https://developer.gnome.org/gobject/unstable/gobject-The-Base-Object-Type.html#G-OBJECT-CLASS:CAPS">G_OBJECT_CLASS</a></span> <span class="gtkdoc opt">(</span>cursor_search_parent_class<span class="gtkdoc opt">)-&gt;</span><span class="function">finalize</span> <span class="gtkdoc opt">(</span>object<span class="gtkdoc opt">);</span>
<span class="gtkdoc opt">}</span>

<span class="gtkdoc kwb">static void</span>
<span class="function">cursor_search_get_property</span> <span class="gtkdoc opt">(</span>GObject <span class="gtkdoc opt">*</span>object<span class="gtkdoc opt">,</span>
                            guint property_id<span class="gtkdoc opt">,</span>
                            GValue <span class="gtkdoc opt">*</span>value<span class="gtkdoc opt">,</span>
                            GParamSpec <span class="gtkdoc opt">*</span>pspec<span class="gtkdoc opt">)</span>
<span class="gtkdoc opt">{</span>
CursorSearch        <span class="gtkdoc opt">*</span>search <span class="gtkdoc opt">=</span> <span class="function">CURSOR_SEARCH</span> <span class="gtkdoc opt">(</span>object<span class="gtkdoc opt">);</span>
CursorSearchPrivate <span class="gtkdoc opt">*</span>priv <span class="gtkdoc opt">=</span> search<span class="gtkdoc opt">-&gt;</span>priv<span class="gtkdoc opt">;</span>

<span class="keyword">switch</span> <span class="gtkdoc opt">(</span>property_id<span class="gtkdoc opt">) {</span>
<span class="keyword">case</span> PROP_SEXP<span class="gtkdoc opt">:</span>
	<span class="function"><a href="https://developer.gnome.org/gobject/unstable/gobject-Standard-Parameter-and-Value-Types.html#g-value-set-string">g_value_set_string</a></span> <span class="gtkdoc opt">(</span>value<span class="gtkdoc opt">,</span> priv<span class="gtkdoc opt">-&gt;</span>sexp<span class="gtkdoc opt">);</span>
	<span class="keyword">break</span><span class="gtkdoc opt">;</span>

<span class="keyword">default</span><span class="gtkdoc opt">:</span>
	<span class="function"><a href="https://developer.gnome.org/gobject/unstable/gobject-The-Base-Object-Type.html#G-OBJECT-WARN-INVALID-PROPERTY-ID:CAPS">G_OBJECT_WARN_INVALID_PROPERTY_ID</a></span> <span class="gtkdoc opt">(</span>object<span class="gtkdoc opt">,</span> property_id<span class="gtkdoc opt">,</span> pspec<span class="gtkdoc opt">);</span>
	<span class="keyword">break</span><span class="gtkdoc opt">;</span>

<span class="gtkdoc opt">}</span>
<span class="gtkdoc opt">}</span>

<span class="comment">/************************************************************************</span>
<span class="comment"> *                              UI Callbacks                            *</span>
<span class="comment"> ************************************************************************/</span>
<span class="gtkdoc kwb">static void</span>
<span class="function">cursor_search_option_toggled</span> <span class="gtkdoc opt">(</span>CursorSearch <span class="gtkdoc opt">*</span>search<span class="gtkdoc opt">,</span>
                              GtkWidget <span class="gtkdoc opt">*</span>item<span class="gtkdoc opt">)</span>
<span class="gtkdoc opt">{</span>
CursorSearchPrivate <span class="gtkdoc opt">*</span>priv <span class="gtkdoc opt">=</span> search<span class="gtkdoc opt">-&gt;</span>priv<span class="gtkdoc opt">;</span>

<span class="keyword">if</span> <span class="gtkdoc opt">(</span><span class="function"><a href="http://developer.gnome.org/gtk2/GtkCheckMenuItem.html#gtk-check-menu-item-get-active">gtk_check_menu_item_get_active</a></span> <span class="gtkdoc opt">(</span><span class="function">GTK_CHECK_MENU_ITEM</span> <span class="gtkdoc opt">(</span>item<span class="gtkdoc opt">))) {</span>

	<span class="keyword">if</span> <span class="gtkdoc opt">(</span>item <span class="gtkdoc opt">==</span> priv<span class="gtkdoc opt">-&gt;</span>name_radio<span class="gtkdoc opt">)</span>
		priv<span class="gtkdoc opt">-&gt;</span>type <span class="gtkdoc opt">=</span> SEARCH_NAME<span class="gtkdoc opt">;</span>
	<span class="keyword">else if</span> <span class="gtkdoc opt">(</span>item <span class="gtkdoc opt">==</span> priv<span class="gtkdoc opt">-&gt;</span>phone_radio<span class="gtkdoc opt">)</span>
		priv<span class="gtkdoc opt">-&gt;</span>type <span class="gtkdoc opt">=</span> SEARCH_PHONE<span class="gtkdoc opt">;</span>
	<span class="keyword">else if</span> <span class="gtkdoc opt">(</span>item <span class="gtkdoc opt">==</span> priv<span class="gtkdoc opt">-&gt;</span>email_radio<span class="gtkdoc opt">)</span>
		priv<span class="gtkdoc opt">-&gt;</span>type <span class="gtkdoc opt">=</span> SEARCH_EMAIL<span class="gtkdoc opt">;</span>

	<span class="comment">/* Refresh the search */</span>
	<span class="function">cursor_search_entry_changed</span> <span class="gtkdoc opt">(</span>search<span class="gtkdoc opt">,</span> NULL<span class="gtkdoc opt">);</span>
<span class="gtkdoc opt">}</span>
<span class="gtkdoc opt">}</span>

<span class="gtkdoc kwb">static void</span>
<span class="function">cursor_search_entry_changed</span> <span class="gtkdoc opt">(</span>CursorSearch <span class="gtkdoc opt">*</span>search<span class="gtkdoc opt">,</span>
                             GtkEditable <span class="gtkdoc opt">*</span>entry<span class="gtkdoc opt">)</span>
<span class="gtkdoc opt">{</span>
CursorSearchPrivate <span class="gtkdoc opt">*</span>priv <span class="gtkdoc opt">=</span> search<span class="gtkdoc opt">-&gt;</span>priv<span class="gtkdoc opt">;</span>
EBookQuery  <span class="gtkdoc opt">*</span>query <span class="gtkdoc opt">=</span> NULL<span class="gtkdoc opt">;</span>
<span class="gtkdoc kwb">const</span> gchar <span class="gtkdoc opt">*</span>text<span class="gtkdoc opt">;</span>

text <span class="gtkdoc opt">=</span> <span class="function"><a href="http://developer.gnome.org/gtk2/GtkEntry.html#gtk-entry-get-text">gtk_entry_get_text</a></span> <span class="gtkdoc opt">(</span><span class="function">GTK_ENTRY</span> <span class="gtkdoc opt">(</span>search<span class="gtkdoc opt">));</span>

<span class="keyword">if</span> <span class="gtkdoc opt">(</span>text <span class="gtkdoc opt">&amp;&amp;</span> text<span class="gtkdoc opt">[</span><span class="number">0</span><span class="gtkdoc opt">]) {</span>
	<span class="keyword">switch</span> <span class="gtkdoc opt">(</span>priv<span class="gtkdoc opt">-&gt;</span>type<span class="gtkdoc opt">) {</span>
	<span class="keyword">case</span> SEARCH_NAME<span class="gtkdoc opt">:</span>
		query <span class="gtkdoc opt">=</span> <span class="function"><a href="eds-EBookQuery.html#e-book-query-orv">e_book_query_orv</a></span> <span class="gtkdoc opt">(</span>
			<span class="function"><a href="eds-EBookQuery.html#e-book-query-field-test">e_book_query_field_test</a></span> <span class="gtkdoc opt">(</span>E_CONTACT_FAMILY_NAME<span class="gtkdoc opt">,</span>
			E_BOOK_QUERY_CONTAINS<span class="gtkdoc opt">,</span>
			text<span class="gtkdoc opt">),</span>
			<span class="function"><a href="eds-EBookQuery.html#e-book-query-field-test">e_book_query_field_test</a></span> <span class="gtkdoc opt">(</span>E_CONTACT_GIVEN_NAME<span class="gtkdoc opt">,</span>
			E_BOOK_QUERY_CONTAINS<span class="gtkdoc opt">,</span>
			text<span class="gtkdoc opt">),</span>
			NULL<span class="gtkdoc opt">);</span>
		<span class="keyword">break</span><span class="gtkdoc opt">;</span>
	<span class="keyword">case</span> SEARCH_PHONE<span class="gtkdoc opt">:</span>
		query <span class="gtkdoc opt">=</span> <span class="function"><a href="eds-EBookQuery.html#e-book-query-field-test">e_book_query_field_test</a></span> <span class="gtkdoc opt">(</span>
			E_CONTACT_TEL<span class="gtkdoc opt">,</span>
			E_BOOK_QUERY_CONTAINS<span class="gtkdoc opt">,</span>
			text<span class="gtkdoc opt">);</span>
		<span class="keyword">break</span><span class="gtkdoc opt">;</span>
	<span class="keyword">case</span> SEARCH_EMAIL<span class="gtkdoc opt">:</span>
		query <span class="gtkdoc opt">=</span> <span class="function"><a href="eds-EBookQuery.html#e-book-query-field-test">e_book_query_field_test</a></span> <span class="gtkdoc opt">(</span>
			E_CONTACT_EMAIL<span class="gtkdoc opt">,</span>
			E_BOOK_QUERY_CONTAINS<span class="gtkdoc opt">,</span>
			text<span class="gtkdoc opt">);</span>
		<span class="keyword">break</span><span class="gtkdoc opt">;</span>
	<span class="gtkdoc opt">}</span>
<span class="gtkdoc opt">}</span>

<span class="function"><a href="https://developer.gnome.org/glib/unstable/glib-Memory-Allocation.html#g-free">g_free</a></span> <span class="gtkdoc opt">(</span>priv<span class="gtkdoc opt">-&gt;</span>sexp<span class="gtkdoc opt">);</span>

<span class="keyword">if</span> <span class="gtkdoc opt">(</span>query<span class="gtkdoc opt">) {</span>
	priv<span class="gtkdoc opt">-&gt;</span>sexp <span class="gtkdoc opt">=</span> <span class="function"><a href="eds-EBookQuery.html#e-book-query-to-string">e_book_query_to_string</a></span> <span class="gtkdoc opt">(</span>query<span class="gtkdoc opt">);</span>
	<span class="function"><a href="eds-EBookQuery.html#e-book-query-unref">e_book_query_unref</a></span> <span class="gtkdoc opt">(</span>query<span class="gtkdoc opt">);</span>
<span class="gtkdoc opt">}</span> <span class="keyword">else</span>
	priv<span class="gtkdoc opt">-&gt;</span>sexp <span class="gtkdoc opt">=</span> <span class="function"><a href="https://developer.gnome.org/glib/unstable/glib-String-Utility-Functions.html#g-strdup">g_strdup</a></span> <span class="gtkdoc opt">(</span><span class="string">&quot;&quot;</span><span class="gtkdoc opt">);</span>

<span class="function"><a href="https://developer.gnome.org/gobject/unstable/gobject-The-Base-Object-Type.html#g-object-notify">g_object_notify</a></span> <span class="gtkdoc opt">(</span><span class="function"><a href="https://developer.gnome.org/gobject/unstable/gobject-The-Base-Object-Type.html#G-OBJECT:CAPS">G_OBJECT</a></span> <span class="gtkdoc opt">(</span>search<span class="gtkdoc opt">),</span> <span class="string">&quot;sexp&quot;</span><span class="gtkdoc opt">);</span>
<span class="gtkdoc opt">}</span>

<span class="gtkdoc kwb">static void</span>
<span class="function">cursor_search_icon_press</span> <span class="gtkdoc opt">(</span>CursorSearch <span class="gtkdoc opt">*</span>search<span class="gtkdoc opt">,</span>
                          GtkEntryIconPosition icon_pos<span class="gtkdoc opt">,</span>
                          GdkEvent <span class="gtkdoc opt">*</span>event<span class="gtkdoc opt">,</span>
                          GtkEntry <span class="gtkdoc opt">*</span>entry<span class="gtkdoc opt">)</span>
<span class="gtkdoc opt">{</span>
CursorSearchPrivate <span class="gtkdoc opt">*</span>priv <span class="gtkdoc opt">=</span> search<span class="gtkdoc opt">-&gt;</span>priv<span class="gtkdoc opt">;</span>
GdkEventButton <span class="gtkdoc opt">*</span>button_event <span class="gtkdoc opt">= (</span>GdkEventButton <span class="gtkdoc opt">*)</span> event<span class="gtkdoc opt">;</span>

<span class="keyword">if</span> <span class="gtkdoc opt">(</span>icon_pos <span class="gtkdoc opt">==</span> GTK_ENTRY_ICON_PRIMARY<span class="gtkdoc opt">)</span>
	<span class="function"><a href="http://developer.gnome.org/gtk2/GtkMenu.html#gtk-menu-popup">gtk_menu_popup</a></span> <span class="gtkdoc opt">(</span>
		<span class="function">GTK_MENU</span> <span class="gtkdoc opt">(</span>priv<span class="gtkdoc opt">-&gt;</span>popup<span class="gtkdoc opt">),</span>
			NULL<span class="gtkdoc opt">,</span> NULL<span class="gtkdoc opt">,</span> NULL<span class="gtkdoc opt">,</span> NULL<span class="gtkdoc opt">,</span>
			button_event<span class="gtkdoc opt">-&gt;</span>button<span class="gtkdoc opt">,</span>
			button_event<span class="gtkdoc opt">-&gt;</span>time<span class="gtkdoc opt">);</span>
<span class="gtkdoc opt">}</span>

<span class="comment">/************************************************************************</span>
<span class="comment"> *                                API                                   *</span>
<span class="comment"> ************************************************************************/</span>
GtkWidget <span class="gtkdoc opt">*</span>
<span class="function">cursor_search_new</span> <span class="gtkdoc opt">(</span><span class="gtkdoc kwb">void</span><span class="gtkdoc opt">)</span>
<span class="gtkdoc opt">{</span>
  <span class="keyword">return</span> <span class="gtkdoc opt">(</span>GtkWidget <span class="gtkdoc opt">*)</span> <span class="function"><a href="https://developer.gnome.org/gobject/unstable/gobject-The-Base-Object-Type.html#g-object-new">g_object_new</a></span> <span class="gtkdoc opt">(</span>CURSOR_TYPE_SEARCH<span class="gtkdoc opt">,</span> NULL<span class="gtkdoc opt">);</span>
<span class="gtkdoc opt">}</span>

<span class="gtkdoc kwb">const</span> gchar <span class="gtkdoc opt">*</span>
<span class="function">cursor_search_get_sexp</span> <span class="gtkdoc opt">(</span>CursorSearch <span class="gtkdoc opt">*</span>search<span class="gtkdoc opt">)</span>
<span class="gtkdoc opt">{</span>
CursorSearchPrivate <span class="gtkdoc opt">*</span>priv<span class="gtkdoc opt">;</span>

<span class="function"><a href="https://developer.gnome.org/glib/unstable/glib-Warnings-and-Assertions.html#g-return-val-if-fail">g_return_val_if_fail</a></span> <span class="gtkdoc opt">(</span><span class="function">CURSOR_IS_SEARCH</span> <span class="gtkdoc opt">(</span>search<span class="gtkdoc opt">),</span> NULL<span class="gtkdoc opt">);</span>

priv <span class="gtkdoc opt">=</span> search<span class="gtkdoc opt">-&gt;</span>priv<span class="gtkdoc opt">;</span>

<span class="keyword">return</span> priv<span class="gtkdoc opt">-&gt;</span>sexp<span class="gtkdoc opt">;</span>
<span class="gtkdoc opt">}</span></pre></td>
      </tr>
    </tbody>
  </table>
</div>

</div>
<div class="refsect1">
<a name="id-1.6.2.7"></a><h2>The contact slot</h2>
<p>
      This is a very simple class who's only purpose is to display
      contact related data, each entry in the list is a 'slot'
    </p>
<div class="informalexample">
  <table class="listing_frame" border="0" cellpadding="0" cellspacing="0">
    <tbody>
      <tr>
        <td class="listing_lines" align="right"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136</pre></td>
        <td class="listing_code"><pre class="programlisting"><span class="comment">/* -*- Mode: C; tab-width: 8; indent-tabs-mode: t; c-basic-offset: 8 -*- */</span>
<span class="comment">/*</span>
<span class="comment"> * Copyright (C) 2013 Intel Corporation</span>
<span class="comment"> *</span>
<span class="comment"> * This library is free software you can redistribute it and/or modify it</span>
<span class="comment"> * under the terms of the GNU Lesser General Public License as published by</span>
<span class="comment"> * the Free Software Foundation.</span>
<span class="comment"> *</span>
<span class="comment"> * This library is distributed in the hope that it will be useful, but</span>
<span class="comment"> * WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY</span>
<span class="comment"> * or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License</span>
<span class="comment"> * for more details.</span>
<span class="comment"> *</span>
<span class="comment"> * You should have received a copy of the GNU Lesser General Public License</span>
<span class="comment"> * along with this library; if not, see &lt;http://www.gnu.org/licenses/&gt;.</span>
<span class="comment"> *</span>
<span class="comment"> * Author: Tristan Van Berkom &lt;tristanvb&#64;openismus.com&gt;</span>
<span class="comment"> */</span>

<span class="gtkdoc ppc">#include &lt;libebook/libebook.h&gt;</span>

<span class="gtkdoc ppc">#include</span> <span class="gtkdoc pps">&quot;cursor-slot.h&quot;</span><span class="gtkdoc ppc"></span>

<span class="gtkdoc kwb">struct</span> _CursorSlotPrivate <span class="gtkdoc opt">{</span>
<span class="comment">/* Screen widgets */</span>
GtkWidget <span class="gtkdoc opt">*</span>area<span class="gtkdoc opt">;</span>
GtkLabel  <span class="gtkdoc opt">*</span>name_label<span class="gtkdoc opt">;</span>
GtkLabel  <span class="gtkdoc opt">*</span>emails_label<span class="gtkdoc opt">;</span>
GtkLabel  <span class="gtkdoc opt">*</span>telephones_label<span class="gtkdoc opt">;</span>
<span class="gtkdoc opt">};</span>

<span class="function"><a href="https://developer.gnome.org/gobject/unstable/gobject-Type-Information.html#G-DEFINE-TYPE-WITH-PRIVATE:CAPS">G_DEFINE_TYPE_WITH_PRIVATE</a></span> <span class="gtkdoc opt">(</span>CursorSlot<span class="gtkdoc opt">,</span> cursor_slot<span class="gtkdoc opt">,</span> GTK_TYPE_GRID<span class="gtkdoc opt">);</span>

<span class="comment">/************************************************************************</span>
<span class="comment"> *                          GObjectClass                                *</span>
<span class="comment"> ************************************************************************/</span>
<span class="gtkdoc kwb">static void</span>
<span class="function">cursor_slot_class_init</span> <span class="gtkdoc opt">(</span>CursorSlotClass <span class="gtkdoc opt">*</span>klass<span class="gtkdoc opt">)</span>
<span class="gtkdoc opt">{</span>
GtkWidgetClass <span class="gtkdoc opt">*</span>widget_class<span class="gtkdoc opt">;</span>

<span class="comment">/* Bind to template */</span>
widget_class <span class="gtkdoc opt">=</span> <span class="function">GTK_WIDGET_CLASS</span> <span class="gtkdoc opt">(</span>klass<span class="gtkdoc opt">);</span>
<span class="function"><a href="http://developer.gnome.org/gtk2/GtkWidget.html#gtk-widget-class-set-template-from-resource">gtk_widget_class_set_template_from_resource</a></span> <span class="gtkdoc opt">(</span>widget_class<span class="gtkdoc opt">,</span> <span class="string">&quot;/org/gnome/evolution/cursor-example/cursor-slot.ui&quot;</span><span class="gtkdoc opt">);</span>
<span class="function"><a href="http://developer.gnome.org/gtk2/GtkWidget.html#gtk-widget-class-bind-template-child-private">gtk_widget_class_bind_template_child_private</a></span> <span class="gtkdoc opt">(</span>widget_class<span class="gtkdoc opt">,</span> CursorSlot<span class="gtkdoc opt">,</span> area<span class="gtkdoc opt">);</span>
<span class="function"><a href="http://developer.gnome.org/gtk2/GtkWidget.html#gtk-widget-class-bind-template-child-private">gtk_widget_class_bind_template_child_private</a></span> <span class="gtkdoc opt">(</span>widget_class<span class="gtkdoc opt">,</span> CursorSlot<span class="gtkdoc opt">,</span> name_label<span class="gtkdoc opt">);</span>
<span class="function"><a href="http://developer.gnome.org/gtk2/GtkWidget.html#gtk-widget-class-bind-template-child-private">gtk_widget_class_bind_template_child_private</a></span> <span class="gtkdoc opt">(</span>widget_class<span class="gtkdoc opt">,</span> CursorSlot<span class="gtkdoc opt">,</span> emails_label<span class="gtkdoc opt">);</span>
<span class="function"><a href="http://developer.gnome.org/gtk2/GtkWidget.html#gtk-widget-class-bind-template-child-private">gtk_widget_class_bind_template_child_private</a></span> <span class="gtkdoc opt">(</span>widget_class<span class="gtkdoc opt">,</span> CursorSlot<span class="gtkdoc opt">,</span> telephones_label<span class="gtkdoc opt">);</span>
<span class="gtkdoc opt">}</span>

<span class="gtkdoc kwb">static void</span>
<span class="function">cursor_slot_init</span> <span class="gtkdoc opt">(</span>CursorSlot <span class="gtkdoc opt">*</span>slot<span class="gtkdoc opt">)</span>
<span class="gtkdoc opt">{</span>
slot<span class="gtkdoc opt">-&gt;</span>priv <span class="gtkdoc opt">=</span> <span class="function">cursor_slot_get_instance_private</span> <span class="gtkdoc opt">(</span>slot<span class="gtkdoc opt">);</span>

<span class="function"><a href="http://developer.gnome.org/gtk2/GtkWidget.html#gtk-widget-init-template">gtk_widget_init_template</a></span> <span class="gtkdoc opt">(</span><span class="function">GTK_WIDGET</span> <span class="gtkdoc opt">(</span>slot<span class="gtkdoc opt">));</span>
<span class="gtkdoc opt">}</span>

<span class="comment">/************************************************************************</span>
<span class="comment"> *                                API                                   *</span>
<span class="comment"> ************************************************************************/</span>
GtkWidget <span class="gtkdoc opt">*</span>
<span class="function">cursor_slot_new</span> <span class="gtkdoc opt">(</span>EContact <span class="gtkdoc opt">*</span>contact<span class="gtkdoc opt">)</span>
<span class="gtkdoc opt">{</span>
  CursorSlot <span class="gtkdoc opt">*</span>slot<span class="gtkdoc opt">;</span>

  slot <span class="gtkdoc opt">=</span> <span class="function"><a href="https://developer.gnome.org/gobject/unstable/gobject-The-Base-Object-Type.html#g-object-new">g_object_new</a></span> <span class="gtkdoc opt">(</span>CURSOR_TYPE_SLOT<span class="gtkdoc opt">,</span> NULL<span class="gtkdoc opt">);</span>

  <span class="function">cursor_slot_set_from_contact</span> <span class="gtkdoc opt">(</span>slot<span class="gtkdoc opt">,</span> contact<span class="gtkdoc opt">);</span>

  <span class="keyword">return</span> <span class="gtkdoc opt">(</span>GtkWidget <span class="gtkdoc opt">*)</span> slot<span class="gtkdoc opt">;</span>
<span class="gtkdoc opt">}</span>

<span class="gtkdoc kwb">static</span> gchar <span class="gtkdoc opt">*</span>
<span class="function">make_string_from_list</span> <span class="gtkdoc opt">(</span>EContact <span class="gtkdoc opt">*</span>contact<span class="gtkdoc opt">,</span>
                       EContactField field<span class="gtkdoc opt">)</span>
<span class="gtkdoc opt">{</span>
GList <span class="gtkdoc opt">*</span>values<span class="gtkdoc opt">, *</span>l<span class="gtkdoc opt">;</span>
GString <span class="gtkdoc opt">*</span>string<span class="gtkdoc opt">;</span>

string <span class="gtkdoc opt">=</span> <span class="function"><a href="https://developer.gnome.org/glib/unstable/glib-Strings.html#g-string-new">g_string_new</a></span> <span class="gtkdoc opt">(</span><span class="string">&quot;&lt;span size=</span><span class="gtkdoc esc">\&quot;</span><span class="string">x-small</span><span class="gtkdoc esc">\&quot;</span><span class="string">&gt;&quot;</span><span class="gtkdoc opt">);</span>
values <span class="gtkdoc opt">=</span> <span class="function"><a href="eds-EContact.html#e-contact-get">e_contact_get</a></span> <span class="gtkdoc opt">(</span>contact<span class="gtkdoc opt">,</span> field<span class="gtkdoc opt">);</span>

<span class="keyword">for</span> <span class="gtkdoc opt">(</span>l <span class="gtkdoc opt">=</span> values<span class="gtkdoc opt">;</span> l<span class="gtkdoc opt">;</span> l <span class="gtkdoc opt">=</span> l<span class="gtkdoc opt">-&gt;</span>next<span class="gtkdoc opt">) {</span>
	gchar <span class="gtkdoc opt">*</span>value <span class="gtkdoc opt">= (</span>gchar <span class="gtkdoc opt">*)</span> l<span class="gtkdoc opt">-&gt;</span>data<span class="gtkdoc opt">;</span>

	<span class="keyword">if</span> <span class="gtkdoc opt">(</span>l<span class="gtkdoc opt">-&gt;</span>prev <span class="gtkdoc opt">!=</span> NULL<span class="gtkdoc opt">)</span>
		<span class="function"><a href="https://developer.gnome.org/glib/unstable/glib-Strings.html#g-string-append">g_string_append</a></span> <span class="gtkdoc opt">(</span>string<span class="gtkdoc opt">,</span> <span class="string">&quot;, &quot;</span><span class="gtkdoc opt">);</span>

	<span class="function"><a href="https://developer.gnome.org/glib/unstable/glib-Strings.html#g-string-append">g_string_append</a></span> <span class="gtkdoc opt">(</span>string<span class="gtkdoc opt">,</span> value<span class="gtkdoc opt">);</span>
<span class="gtkdoc opt">}</span>

<span class="keyword">if</span> <span class="gtkdoc opt">(!</span>values<span class="gtkdoc opt">)</span>
	<span class="function"><a href="https://developer.gnome.org/glib/unstable/glib-Strings.html#g-string-append">g_string_append</a></span> <span class="gtkdoc opt">(</span>string<span class="gtkdoc opt">,</span> <span class="string">&quot; - none - &quot;</span><span class="gtkdoc opt">);</span>

<span class="function"><a href="eds-EContact.html#e-contact-attr-list-free">e_contact_attr_list_free</a></span> <span class="gtkdoc opt">(</span>values<span class="gtkdoc opt">);</span>
<span class="function"><a href="https://developer.gnome.org/glib/unstable/glib-Strings.html#g-string-append">g_string_append</a></span> <span class="gtkdoc opt">(</span>string<span class="gtkdoc opt">,</span> <span class="string">&quot;&lt;/span&gt;&quot;</span><span class="gtkdoc opt">);</span>

<span class="keyword">return</span> <span class="function"><a href="https://developer.gnome.org/glib/unstable/glib-Strings.html#g-string-free">g_string_free</a></span> <span class="gtkdoc opt">(</span>string<span class="gtkdoc opt">,</span> FALSE<span class="gtkdoc opt">);</span>
<span class="gtkdoc opt">}</span>

<span class="gtkdoc kwb">void</span>
<span class="function">cursor_slot_set_from_contact</span> <span class="gtkdoc opt">(</span>CursorSlot <span class="gtkdoc opt">*</span>slot<span class="gtkdoc opt">,</span>
                              EContact <span class="gtkdoc opt">*</span>contact<span class="gtkdoc opt">)</span>
<span class="gtkdoc opt">{</span>
CursorSlotPrivate <span class="gtkdoc opt">*</span>priv<span class="gtkdoc opt">;</span>
<span class="gtkdoc kwb">const</span> gchar <span class="gtkdoc opt">*</span>family_name<span class="gtkdoc opt">, *</span>given_name<span class="gtkdoc opt">;</span>
gchar <span class="gtkdoc opt">*</span>str<span class="gtkdoc opt">;</span>

<span class="function"><a href="https://developer.gnome.org/glib/unstable/glib-Warnings-and-Assertions.html#g-return-if-fail">g_return_if_fail</a></span> <span class="gtkdoc opt">(</span><span class="function">CURSOR_IS_SLOT</span> <span class="gtkdoc opt">(</span>slot<span class="gtkdoc opt">));</span>
<span class="function"><a href="https://developer.gnome.org/glib/unstable/glib-Warnings-and-Assertions.html#g-return-if-fail">g_return_if_fail</a></span> <span class="gtkdoc opt">(</span>contact <span class="gtkdoc opt">==</span> NULL <span class="gtkdoc opt">||</span> <span class="function">E_IS_CONTACT</span> <span class="gtkdoc opt">(</span>contact<span class="gtkdoc opt">));</span>

priv <span class="gtkdoc opt">=</span> slot<span class="gtkdoc opt">-&gt;</span>priv<span class="gtkdoc opt">;</span>

<span class="keyword">if</span> <span class="gtkdoc opt">(!</span>contact<span class="gtkdoc opt">) {</span>
	<span class="function"><a href="http://developer.gnome.org/gtk2/GtkWidget.html#gtk-widget-hide">gtk_widget_hide</a></span> <span class="gtkdoc opt">(</span>priv<span class="gtkdoc opt">-&gt;</span>area<span class="gtkdoc opt">);</span>
	<span class="keyword">return</span><span class="gtkdoc opt">;</span>
<span class="gtkdoc opt">}</span>

family_name <span class="gtkdoc opt">= (</span><span class="gtkdoc kwb">const</span> gchar <span class="gtkdoc opt">*)</span> <span class="function"><a href="eds-EContact.html#e-contact-get-const">e_contact_get_const</a></span> <span class="gtkdoc opt">(</span>contact<span class="gtkdoc opt">,</span> E_CONTACT_FAMILY_NAME<span class="gtkdoc opt">);</span>
given_name <span class="gtkdoc opt">= (</span><span class="gtkdoc kwb">const</span> gchar <span class="gtkdoc opt">*)</span> <span class="function"><a href="eds-EContact.html#e-contact-get-const">e_contact_get_const</a></span> <span class="gtkdoc opt">(</span>contact<span class="gtkdoc opt">,</span> E_CONTACT_GIVEN_NAME<span class="gtkdoc opt">);</span>

str <span class="gtkdoc opt">=</span> <span class="function"><a href="https://developer.gnome.org/glib/unstable/glib-String-Utility-Functions.html#g-strdup-printf">g_strdup_printf</a></span> <span class="gtkdoc opt">(</span><span class="string">&quot;%s, %s&quot;</span><span class="gtkdoc opt">,</span> family_name<span class="gtkdoc opt">,</span> given_name<span class="gtkdoc opt">);</span>
<span class="function"><a href="http://developer.gnome.org/gtk2/GtkLabel.html#gtk-label-set-text">gtk_label_set_text</a></span> <span class="gtkdoc opt">(</span>priv<span class="gtkdoc opt">-&gt;</span>name_label<span class="gtkdoc opt">,</span> str<span class="gtkdoc opt">);</span>
<span class="function"><a href="https://developer.gnome.org/glib/unstable/glib-Memory-Allocation.html#g-free">g_free</a></span> <span class="gtkdoc opt">(</span>str<span class="gtkdoc opt">);</span>

str <span class="gtkdoc opt">=</span> <span class="function">make_string_from_list</span> <span class="gtkdoc opt">(</span>contact<span class="gtkdoc opt">,</span> E_CONTACT_EMAIL<span class="gtkdoc opt">);</span>
<span class="function"><a href="http://developer.gnome.org/gtk2/GtkLabel.html#gtk-label-set-markup">gtk_label_set_markup</a></span> <span class="gtkdoc opt">(</span>priv<span class="gtkdoc opt">-&gt;</span>emails_label<span class="gtkdoc opt">,</span> str<span class="gtkdoc opt">);</span>
<span class="function"><a href="https://developer.gnome.org/glib/unstable/glib-Memory-Allocation.html#g-free">g_free</a></span> <span class="gtkdoc opt">(</span>str<span class="gtkdoc opt">);</span>

str <span class="gtkdoc opt">=</span> <span class="function">make_string_from_list</span> <span class="gtkdoc opt">(</span>contact<span class="gtkdoc opt">,</span> E_CONTACT_TEL<span class="gtkdoc opt">);</span>
<span class="function"><a href="http://developer.gnome.org/gtk2/GtkLabel.html#gtk-label-set-markup">gtk_label_set_markup</a></span> <span class="gtkdoc opt">(</span>priv<span class="gtkdoc opt">-&gt;</span>telephones_label<span class="gtkdoc opt">,</span> str<span class="gtkdoc opt">);</span>
<span class="function"><a href="https://developer.gnome.org/glib/unstable/glib-Memory-Allocation.html#g-free">g_free</a></span> <span class="gtkdoc opt">(</span>str<span class="gtkdoc opt">);</span>

<span class="function"><a href="http://developer.gnome.org/gtk2/GtkWidget.html#gtk-widget-show">gtk_widget_show</a></span> <span class="gtkdoc opt">(</span>priv<span class="gtkdoc opt">-&gt;</span>area<span class="gtkdoc opt">);</span>
<span class="gtkdoc opt">}</span></pre></td>
      </tr>
    </tbody>
  </table>
</div>

</div>
<div class="refsect1">
<a name="id-1.6.2.8"></a><h2>Creating addressbooks and loading vcards</h2>
<p>
      This is the messy part of the example, here we take care
      of creating a custom addressbook and populating it with
      the contacts found in the directory given to the example.
    </p>
<div class="informalexample">
  <table class="listing_frame" border="0" cellpadding="0" cellspacing="0">
    <tbody>
      <tr>
        <td class="listing_lines" align="right"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250</pre></td>
        <td class="listing_code"><pre class="programlisting"><span class="comment">/* -*- Mode: C; tab-width: 8; indent-tabs-mode: t; c-basic-offset: 8 -*- */</span>
<span class="comment">/*</span>
<span class="comment"> * Copyright (C) 2013 Intel Corporation</span>
<span class="comment"> *</span>
<span class="comment"> * This library is free software you can redistribute it and/or modify it</span>
<span class="comment"> * under the terms of the GNU Lesser General Public License as published by</span>
<span class="comment"> * the Free Software Foundation.</span>
<span class="comment"> *</span>
<span class="comment"> * This library is distributed in the hope that it will be useful, but</span>
<span class="comment"> * WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY</span>
<span class="comment"> * or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License</span>
<span class="comment"> * for more details.</span>
<span class="comment"> *</span>
<span class="comment"> * You should have received a copy of the GNU Lesser General Public License</span>
<span class="comment"> * along with this library; if not, see &lt;http://www.gnu.org/licenses/&gt;.</span>
<span class="comment"> *</span>
<span class="comment"> * Author: Tristan Van Berkom &lt;tristanvb&#64;openismus.com&gt;</span>
<span class="comment"> */</span>
<span class="gtkdoc ppc">#include</span> <span class="gtkdoc pps">&quot;cursor-data.h&quot;</span><span class="gtkdoc ppc"></span>

<span class="gtkdoc ppc">#define CURSOR_DATA_SOURCE_ID</span> <span class="gtkdoc pps">&quot;cursor-example-book&quot;</span><span class="gtkdoc ppc"></span>

<span class="comment">/* We need to spin the main loop a bit to wait for the ESource</span>
<span class="comment"> * to be created. This particular API is admittedly cumbersome,</span>
<span class="comment"> * hopefully this will be fixed in a later version so that</span>
<span class="comment"> * the ESource can be synchronously created.</span>
<span class="comment"> *</span>
<span class="comment"> * Just an example so lets just use some global variables here...</span>
<span class="comment"> */</span>
<span class="gtkdoc kwb">static</span> EBookClient <span class="gtkdoc opt">*</span>address_book <span class="gtkdoc opt">=</span> NULL<span class="gtkdoc opt">;</span>
<span class="gtkdoc kwb">static</span> ESource     <span class="gtkdoc opt">*</span>address_book_source <span class="gtkdoc opt">=</span> NULL<span class="gtkdoc opt">;</span>

<span class="gtkdoc kwb">static void</span>
<span class="function">cursor_data_source_added</span> <span class="gtkdoc opt">(</span>ESourceRegistry <span class="gtkdoc opt">*</span>registry<span class="gtkdoc opt">,</span>
                          ESource <span class="gtkdoc opt">*</span>source<span class="gtkdoc opt">,</span>
                          gpointer data<span class="gtkdoc opt">)</span>
<span class="gtkdoc opt">{</span>
GError    <span class="gtkdoc opt">*</span>error <span class="gtkdoc opt">=</span> NULL<span class="gtkdoc opt">;</span>
GMainLoop <span class="gtkdoc opt">*</span>loop <span class="gtkdoc opt">= (</span>GMainLoop <span class="gtkdoc opt">*)</span> data<span class="gtkdoc opt">;</span>

<span class="keyword">if</span> <span class="gtkdoc opt">(</span><span class="function"><a href="https://developer.gnome.org/glib/unstable/glib-String-Utility-Functions.html#g-strcmp0">g_strcmp0</a></span> <span class="gtkdoc opt">(</span><span class="function"><a href="eds-ESource.html#e-source-get-uid">e_source_get_uid</a></span> <span class="gtkdoc opt">(</span>source<span class="gtkdoc opt">),</span> CURSOR_DATA_SOURCE_ID<span class="gtkdoc opt">) !=</span> <span class="number">0</span><span class="gtkdoc opt">)</span>
	<span class="keyword">return</span><span class="gtkdoc opt">;</span>

<span class="comment">/* Open the address book */</span>
address_book <span class="gtkdoc opt">= (</span>EBookClient <span class="gtkdoc opt">*)</span> <span class="function"><a href="eds-EBookClient.html#e-book-client-connect-sync">e_book_client_connect_sync</a></span> <span class="gtkdoc opt">(</span>source<span class="gtkdoc opt">,</span> NULL<span class="gtkdoc opt">, &amp;</span>error<span class="gtkdoc opt">);</span>
<span class="keyword">if</span> <span class="gtkdoc opt">(!</span>address_book<span class="gtkdoc opt">)</span>
	<span class="function"><a href="https://developer.gnome.org/glib/unstable/glib-Message-Logging.html#g-error">g_error</a></span> <span class="gtkdoc opt">(</span><span class="string">&quot;Unable to create the test book: %s&quot;</span><span class="gtkdoc opt">,</span> error<span class="gtkdoc opt">-&gt;</span>message<span class="gtkdoc opt">);</span>

address_book_source <span class="gtkdoc opt">=</span> <span class="function"><a href="https://developer.gnome.org/gobject/unstable/gobject-The-Base-Object-Type.html#g-object-ref">g_object_ref</a></span> <span class="gtkdoc opt">(</span>source<span class="gtkdoc opt">);</span>

<span class="keyword">if</span> <span class="gtkdoc opt">(</span>loop<span class="gtkdoc opt">)</span>
	<span class="function"><a href="https://developer.gnome.org/glib/unstable/glib-The-Main-Event-Loop.html#g-main-loop-quit">g_main_loop_quit</a></span> <span class="gtkdoc opt">(</span>loop<span class="gtkdoc opt">);</span>
<span class="gtkdoc opt">}</span>

<span class="gtkdoc kwb">static</span> gboolean
<span class="function">cursor_data_source_timeout</span> <span class="gtkdoc opt">(</span>gpointer user_data<span class="gtkdoc opt">)</span>
<span class="gtkdoc opt">{</span>
<span class="function"><a href="https://developer.gnome.org/glib/unstable/glib-Message-Logging.html#g-error">g_error</a></span> <span class="gtkdoc opt">(</span><span class="string">&quot;Timed out while waiting for ESource creation from the registry&quot;</span><span class="gtkdoc opt">);</span>

<span class="keyword">return</span> FALSE<span class="gtkdoc opt">;</span>
<span class="gtkdoc opt">}</span>

<span class="comment">/*</span>
<span class="comment"> * Helper function to load a contact from a vcard file.</span>
<span class="comment"> */</span>
<span class="gtkdoc kwb">static</span> EContact <span class="gtkdoc opt">*</span>
<span class="function">contact_from_file</span> <span class="gtkdoc opt">(</span><span class="gtkdoc kwb">const</span> gchar <span class="gtkdoc opt">*</span>vcard_file<span class="gtkdoc opt">)</span>
<span class="gtkdoc opt">{</span>
EContact <span class="gtkdoc opt">*</span>contact<span class="gtkdoc opt">;</span>
GError <span class="gtkdoc opt">*</span>error<span class="gtkdoc opt">;</span>
gchar <span class="gtkdoc opt">*</span>vcard <span class="gtkdoc opt">=</span> NULL<span class="gtkdoc opt">;</span>

<span class="keyword">if</span> <span class="gtkdoc opt">(!</span><span class="function"><a href="https://developer.gnome.org/glib/unstable/glib-File-Utilities.html#g-file-get-contents">g_file_get_contents</a></span> <span class="gtkdoc opt">(</span>vcard_file<span class="gtkdoc opt">, &amp;</span>vcard<span class="gtkdoc opt">,</span> NULL<span class="gtkdoc opt">, &amp;</span>error<span class="gtkdoc opt">))</span>
	<span class="function"><a href="https://developer.gnome.org/glib/unstable/glib-Message-Logging.html#g-error">g_error</a></span> <span class="gtkdoc opt">(</span><span class="string">&quot;Failed to load vcard: %s&quot;</span><span class="gtkdoc opt">,</span> error<span class="gtkdoc opt">-&gt;</span>message<span class="gtkdoc opt">);</span>

contact <span class="gtkdoc opt">=</span> <span class="function"><a href="eds-EContact.html#e-contact-new-from-vcard">e_contact_new_from_vcard</a></span> <span class="gtkdoc opt">(</span>vcard<span class="gtkdoc opt">);</span>
<span class="function"><a href="https://developer.gnome.org/glib/unstable/glib-Memory-Allocation.html#g-free">g_free</a></span> <span class="gtkdoc opt">(</span>vcard<span class="gtkdoc opt">);</span>

<span class="keyword">return</span> contact<span class="gtkdoc opt">;</span>
<span class="gtkdoc opt">}</span>

<span class="comment">/*</span>
<span class="comment"> * Load all the contacts from 'vcard_directory', and add them to 'client'.</span>
<span class="comment"> */</span>
<span class="gtkdoc kwb">static void</span>
<span class="function">load_contacts</span> <span class="gtkdoc opt">(</span>EBookClient <span class="gtkdoc opt">*</span>client<span class="gtkdoc opt">,</span>
               <span class="gtkdoc kwb">const</span> gchar <span class="gtkdoc opt">*</span>vcard_directory<span class="gtkdoc opt">)</span>
<span class="gtkdoc opt">{</span>
GDir <span class="gtkdoc opt">*</span>dir<span class="gtkdoc opt">;</span>
GError <span class="gtkdoc opt">*</span>error <span class="gtkdoc opt">=</span> NULL<span class="gtkdoc opt">;</span>
<span class="gtkdoc kwb">const</span> gchar <span class="gtkdoc opt">*</span>filename<span class="gtkdoc opt">;</span>
GSList <span class="gtkdoc opt">*</span>contacts <span class="gtkdoc opt">=</span> NULL<span class="gtkdoc opt">;</span>

dir <span class="gtkdoc opt">=</span> <span class="function"><a href="https://developer.gnome.org/glib/unstable/glib-File-Utilities.html#g-dir-open">g_dir_open</a></span> <span class="gtkdoc opt">(</span>vcard_directory<span class="gtkdoc opt">,</span> <span class="number">0</span><span class="gtkdoc opt">, &amp;</span>error<span class="gtkdoc opt">);</span>
<span class="keyword">if</span> <span class="gtkdoc opt">(!</span>dir<span class="gtkdoc opt">)</span>
	<span class="function"><a href="https://developer.gnome.org/glib/unstable/glib-Message-Logging.html#g-error">g_error</a></span> <span class="gtkdoc opt">(</span><span class="string">&quot;Failed to open vcard directory '%s': %s&quot;</span><span class="gtkdoc opt">,</span> vcard_directory<span class="gtkdoc opt">,</span> error<span class="gtkdoc opt">-&gt;</span>message<span class="gtkdoc opt">);</span>

<span class="keyword">while</span> <span class="gtkdoc opt">((</span>filename <span class="gtkdoc opt">=</span> <span class="function"><a href="https://developer.gnome.org/glib/unstable/glib-File-Utilities.html#g-dir-read-name">g_dir_read_name</a></span> <span class="gtkdoc opt">(</span>dir<span class="gtkdoc opt">)) !=</span> NULL<span class="gtkdoc opt">) {</span>

	<span class="keyword">if</span> <span class="gtkdoc opt">(</span><span class="function"><a href="https://developer.gnome.org/glib/unstable/glib-String-Utility-Functions.html#g-str-has-suffix">g_str_has_suffix</a></span> <span class="gtkdoc opt">(</span>filename<span class="gtkdoc opt">,</span> <span class="string">&quot;.vcf&quot;</span><span class="gtkdoc opt">)) {</span>
		gchar <span class="gtkdoc opt">*</span>fullpath <span class="gtkdoc opt">=</span> <span class="function"><a href="https://developer.gnome.org/glib/unstable/glib-Miscellaneous-Utility-Functions.html#g-build-filename">g_build_filename</a></span> <span class="gtkdoc opt">(</span>vcard_directory<span class="gtkdoc opt">,</span> filename<span class="gtkdoc opt">,</span> NULL<span class="gtkdoc opt">);</span>
		EContact <span class="gtkdoc opt">*</span>contact<span class="gtkdoc opt">;</span>

		contact <span class="gtkdoc opt">=</span> <span class="function">contact_from_file</span> <span class="gtkdoc opt">(</span>fullpath<span class="gtkdoc opt">);</span>
		contacts <span class="gtkdoc opt">=</span> <span class="function"><a href="https://developer.gnome.org/glib/unstable/glib-Singly-Linked-Lists.html#g-slist-prepend">g_slist_prepend</a></span> <span class="gtkdoc opt">(</span>contacts<span class="gtkdoc opt">,</span> contact<span class="gtkdoc opt">);</span>

		<span class="function"><a href="https://developer.gnome.org/glib/unstable/glib-Memory-Allocation.html#g-free">g_free</a></span> <span class="gtkdoc opt">(</span>fullpath<span class="gtkdoc opt">);</span>
	<span class="gtkdoc opt">}</span>
<span class="gtkdoc opt">}</span>

<span class="function"><a href="https://developer.gnome.org/glib/unstable/glib-File-Utilities.html#g-dir-close">g_dir_close</a></span> <span class="gtkdoc opt">(</span>dir<span class="gtkdoc opt">);</span>

<span class="keyword">if</span> <span class="gtkdoc opt">(</span>contacts <span class="gtkdoc opt">!=</span> NULL<span class="gtkdoc opt">) {</span>

	<span class="keyword">if</span> <span class="gtkdoc opt">(!</span><span class="function"><a href="eds-EBookClient.html#e-book-client-add-contacts-sync">e_book_client_add_contacts_sync</a></span> <span class="gtkdoc opt">(</span>client<span class="gtkdoc opt">,</span> contacts<span class="gtkdoc opt">,</span> NULL<span class="gtkdoc opt">,</span> NULL<span class="gtkdoc opt">, &amp;</span>error<span class="gtkdoc opt">)) {</span>

		<span class="comment">/* If they were already added, ignore the error */</span>
		<span class="keyword">if</span> <span class="gtkdoc opt">(</span><span class="function"><a href="https://developer.gnome.org/glib/unstable/glib-Error-Reporting.html#g-error-matches">g_error_matches</a></span> <span class="gtkdoc opt">(</span>error<span class="gtkdoc opt">,</span> E_BOOK_CLIENT_ERROR<span class="gtkdoc opt">,</span>
				     E_BOOK_CLIENT_ERROR_CONTACT_ID_ALREADY_EXISTS<span class="gtkdoc opt">))</span>
			<span class="function"><a href="https://developer.gnome.org/glib/unstable/glib-Error-Reporting.html#g-clear-error">g_clear_error</a></span> <span class="gtkdoc opt">(&amp;</span>error<span class="gtkdoc opt">);</span>
		<span class="keyword">else</span>
			<span class="function"><a href="https://developer.gnome.org/glib/unstable/glib-Message-Logging.html#g-error">g_error</a></span> <span class="gtkdoc opt">(</span><span class="string">&quot;Failed to add test contacts: %s&quot;</span><span class="gtkdoc opt">,</span> error<span class="gtkdoc opt">-&gt;</span>message<span class="gtkdoc opt">);</span>
	<span class="gtkdoc opt">}</span>
<span class="gtkdoc opt">}</span>
<span class="gtkdoc opt">}</span>

<span class="comment">/*</span>
<span class="comment"> * Create an EBookClient cursor sorted by family name, and then by given name as</span>
<span class="comment"> * the secondary sort key.</span>
<span class="comment"> */</span>
<span class="gtkdoc kwb">static</span> EBookClientCursor <span class="gtkdoc opt">*</span>
<span class="function">get_cursor</span> <span class="gtkdoc opt">(</span>EBookClient <span class="gtkdoc opt">*</span>book_client<span class="gtkdoc opt">)</span>
<span class="gtkdoc opt">{</span>
  EContactField sort_fields<span class="gtkdoc opt">[] = {</span> E_CONTACT_FAMILY_NAME<span class="gtkdoc opt">,</span> E_CONTACT_GIVEN_NAME <span class="gtkdoc opt">};</span>
  EBookCursorSortType sort_types<span class="gtkdoc opt">[] = {</span> E_BOOK_CURSOR_SORT_ASCENDING<span class="gtkdoc opt">,</span> E_BOOK_CURSOR_SORT_ASCENDING <span class="gtkdoc opt">};</span>
  EBookClientCursor <span class="gtkdoc opt">*</span>cursor <span class="gtkdoc opt">=</span> NULL<span class="gtkdoc opt">;</span>
  GError <span class="gtkdoc opt">*</span>error <span class="gtkdoc opt">=</span> NULL<span class="gtkdoc opt">;</span>

  <span class="keyword">if</span> <span class="gtkdoc opt">(!</span><span class="function"><a href="eds-EBookClient.html#e-book-client-get-cursor-sync">e_book_client_get_cursor_sync</a></span> <span class="gtkdoc opt">(</span>book_client<span class="gtkdoc opt">,</span>
			      NULL<span class="gtkdoc opt">,</span>
			      sort_fields<span class="gtkdoc opt">,</span>
			      sort_types<span class="gtkdoc opt">,</span>
			      <span class="number">2</span><span class="gtkdoc opt">,</span>
			      <span class="gtkdoc opt">&amp;</span>cursor<span class="gtkdoc opt">,</span>
			      NULL<span class="gtkdoc opt">,</span>
			      <span class="gtkdoc opt">&amp;</span>error<span class="gtkdoc opt">)) {</span>
  <span class="function"><a href="https://developer.gnome.org/glib/unstable/glib-Message-Logging.html#g-warning">g_warning</a></span> <span class="gtkdoc opt">(</span><span class="string">&quot;Unable to create cursor&quot;</span><span class="gtkdoc opt">);</span>
  <span class="function"><a href="https://developer.gnome.org/glib/unstable/glib-Error-Reporting.html#g-clear-error">g_clear_error</a></span> <span class="gtkdoc opt">(&amp;</span>error<span class="gtkdoc opt">);</span>
  <span class="gtkdoc opt">}</span>

  <span class="keyword">return</span> cursor<span class="gtkdoc opt">;</span>
<span class="gtkdoc opt">}</span>

<span class="comment">/* Entry point for this file, here we take care of</span>
<span class="comment"> * creating the addressbook if it doesnt exist,</span>
<span class="comment"> * getting an EBookClient, and creating our EBookClientCursor.</span>
<span class="comment"> */</span>
EBookClient <span class="gtkdoc opt">*</span>
<span class="function">cursor_load_data</span> <span class="gtkdoc opt">(</span><span class="gtkdoc kwb">const</span> gchar <span class="gtkdoc opt">*</span>vcard_path<span class="gtkdoc opt">,</span>
                  EBookClientCursor <span class="gtkdoc opt">**</span>ret_cursor<span class="gtkdoc opt">)</span>
<span class="gtkdoc opt">{</span>
ESourceRegistry <span class="gtkdoc opt">*</span>registry<span class="gtkdoc opt">;</span>
ESource <span class="gtkdoc opt">*</span>scratch<span class="gtkdoc opt">;</span>
ESourceBackend <span class="gtkdoc opt">*</span>backend <span class="gtkdoc opt">=</span> NULL<span class="gtkdoc opt">;</span>
GMainLoop <span class="gtkdoc opt">*</span>loop<span class="gtkdoc opt">;</span>
GError  <span class="gtkdoc opt">*</span>error <span class="gtkdoc opt">=</span> NULL<span class="gtkdoc opt">;</span>
EBookClient <span class="gtkdoc opt">*</span>ret_book<span class="gtkdoc opt">;</span>

<span class="function"><a href="https://developer.gnome.org/glib/unstable/glib-Warnings-and-Assertions.html#g-return-val-if-fail">g_return_val_if_fail</a></span> <span class="gtkdoc opt">(</span>vcard_path <span class="gtkdoc opt">!=</span> NULL<span class="gtkdoc opt">,</span> NULL<span class="gtkdoc opt">);</span>
<span class="function"><a href="https://developer.gnome.org/glib/unstable/glib-Warnings-and-Assertions.html#g-return-val-if-fail">g_return_val_if_fail</a></span> <span class="gtkdoc opt">(</span>ret_cursor <span class="gtkdoc opt">!=</span> NULL<span class="gtkdoc opt">,</span> NULL<span class="gtkdoc opt">);</span>

<span class="function"><a href="https://developer.gnome.org/glib/unstable/glib-Warnings-and-Assertions.html#g-print">g_print</a></span> <span class="gtkdoc opt">(</span><span class="string">&quot;Cursor loading data from %s</span><span class="gtkdoc esc">\n</span><span class="string">&quot;</span><span class="gtkdoc opt">,</span> vcard_path<span class="gtkdoc opt">);</span>

loop <span class="gtkdoc opt">=</span> <span class="function"><a href="https://developer.gnome.org/glib/unstable/glib-The-Main-Event-Loop.html#g-main-loop-new">g_main_loop_new</a></span> <span class="gtkdoc opt">(</span>NULL<span class="gtkdoc opt">,</span> FALSE<span class="gtkdoc opt">);</span>

registry <span class="gtkdoc opt">=</span> <span class="function"><a href="eds-ESourceRegistry.html#e-source-registry-new-sync">e_source_registry_new_sync</a></span> <span class="gtkdoc opt">(</span>NULL<span class="gtkdoc opt">, &amp;</span>error<span class="gtkdoc opt">);</span>
<span class="keyword">if</span> <span class="gtkdoc opt">(!</span>registry<span class="gtkdoc opt">)</span>
	<span class="function"><a href="https://developer.gnome.org/glib/unstable/glib-Message-Logging.html#g-error">g_error</a></span> <span class="gtkdoc opt">(</span><span class="string">&quot;Unable to create the registry: %s&quot;</span><span class="gtkdoc opt">,</span> error<span class="gtkdoc opt">-&gt;</span>message<span class="gtkdoc opt">);</span>

<span class="comment">/* Listen to the registry for our added source */</span>
<span class="function"><a href="https://developer.gnome.org/gobject/unstable/gobject-Signals.html#g-signal-connect">g_signal_connect</a></span> <span class="gtkdoc opt">(</span>
	registry<span class="gtkdoc opt">,</span> <span class="string">&quot;source-added&quot;</span><span class="gtkdoc opt">,</span>
	<span class="function"><a href="https://developer.gnome.org/gobject/unstable/gobject-Closures.html#G-CALLBACK:CAPS">G_CALLBACK</a></span> <span class="gtkdoc opt">(</span>cursor_data_source_added<span class="gtkdoc opt">),</span> loop<span class="gtkdoc opt">);</span>

<span class="comment">/* Now create a scratch source for our addressbook */</span>
scratch <span class="gtkdoc opt">=</span> <span class="function"><a href="eds-ESource.html#e-source-new-with-uid">e_source_new_with_uid</a></span> <span class="gtkdoc opt">(</span>CURSOR_DATA_SOURCE_ID<span class="gtkdoc opt">,</span> NULL<span class="gtkdoc opt">, &amp;</span>error<span class="gtkdoc opt">);</span>

<span class="comment">/* Ensure the new ESource will be a local addressbook source */</span>
backend <span class="gtkdoc opt">=</span> <span class="function"><a href="eds-ESource.html#e-source-get-extension">e_source_get_extension</a></span> <span class="gtkdoc opt">(</span>scratch<span class="gtkdoc opt">,</span> E_SOURCE_EXTENSION_ADDRESS_BOOK<span class="gtkdoc opt">);</span>
<span class="function"><a href="eds-ESourceBackend.html#e-source-backend-set-backend-name">e_source_backend_set_backend_name</a></span> <span class="gtkdoc opt">(</span>backend<span class="gtkdoc opt">,</span> <span class="string">&quot;local&quot;</span><span class="gtkdoc opt">);</span>

<span class="comment">/* Now is the right time to use the ESourceBackendSummarySetup to configure</span>
<span class="comment"> * your newly created addressbook. This configuration should happen on the</span>
<span class="comment"> * scratch source before calling e_source_registry_commit_source_sync().</span>
<span class="comment"> */</span>

<span class="comment">/* Commit the source to the registry */</span>
<span class="keyword">if</span> <span class="gtkdoc opt">(!</span><span class="function"><a href="eds-ESourceRegistry.html#e-source-registry-commit-source-sync">e_source_registry_commit_source_sync</a></span> <span class="gtkdoc opt">(</span>registry<span class="gtkdoc opt">,</span> scratch<span class="gtkdoc opt">,</span> NULL<span class="gtkdoc opt">, &amp;</span>error<span class="gtkdoc opt">)) {</span>

	<span class="comment">/* It's possible the source already exists if we already ran the example with this data server */</span>
	<span class="keyword">if</span> <span class="gtkdoc opt">(</span><span class="function"><a href="https://developer.gnome.org/glib/unstable/glib-Error-Reporting.html#g-error-matches">g_error_matches</a></span> <span class="gtkdoc opt">(</span>error<span class="gtkdoc opt">,</span> G_IO_ERROR<span class="gtkdoc opt">,</span> G_IO_ERROR_EXISTS<span class="gtkdoc opt">)) {</span>
		<span class="comment">/* If so... then just call our callback early */</span>
		ESource <span class="gtkdoc opt">*</span>source <span class="gtkdoc opt">=</span> <span class="function"><a href="eds-ESourceRegistry.html#e-source-registry-ref-source">e_source_registry_ref_source</a></span> <span class="gtkdoc opt">(</span>registry<span class="gtkdoc opt">,</span> CURSOR_DATA_SOURCE_ID<span class="gtkdoc opt">);</span>

		<span class="function"><a href="https://developer.gnome.org/glib/unstable/glib-Error-Reporting.html#g-clear-error">g_clear_error</a></span> <span class="gtkdoc opt">(&amp;</span>error<span class="gtkdoc opt">);</span>
		<span class="function"><a href="https://developer.gnome.org/glib/unstable/glib-Testing.html#g-assert">g_assert</a></span> <span class="gtkdoc opt">(</span><span class="function">E_IS_SOURCE</span> <span class="gtkdoc opt">(</span>source<span class="gtkdoc opt">));</span>

		<span class="comment">/* Run the callback which creates the addressbook client connection */</span>
		<span class="function">cursor_data_source_added</span> <span class="gtkdoc opt">(</span>registry<span class="gtkdoc opt">,</span> source<span class="gtkdoc opt">,</span> NULL<span class="gtkdoc opt">);</span>
		<span class="function"><a href="https://developer.gnome.org/gobject/unstable/gobject-The-Base-Object-Type.html#g-object-unref">g_object_unref</a></span> <span class="gtkdoc opt">(</span>source<span class="gtkdoc opt">);</span>
	<span class="gtkdoc opt">}</span> <span class="keyword">else</span>
		<span class="function"><a href="https://developer.gnome.org/glib/unstable/glib-Message-Logging.html#g-error">g_error</a></span> <span class="gtkdoc opt">(</span><span class="string">&quot;Unable to add new addressbook source to the registry: %s&quot;</span><span class="gtkdoc opt">,</span> error<span class="gtkdoc opt">-&gt;</span>message<span class="gtkdoc opt">);</span>
<span class="gtkdoc opt">}</span>

<span class="function"><a href="https://developer.gnome.org/gobject/unstable/gobject-The-Base-Object-Type.html#g-object-unref">g_object_unref</a></span> <span class="gtkdoc opt">(</span>scratch<span class="gtkdoc opt">);</span>

<span class="comment">/* Give EDS a little time to actually create the ESource remotely and</span>
<span class="comment"> * also have a copy if it cached locally, wait for the &quot;source-added&quot;</span>
<span class="comment"> * signal.</span>
<span class="comment"> */</span>
<span class="keyword">if</span> <span class="gtkdoc opt">(</span>address_book <span class="gtkdoc opt">==</span> NULL<span class="gtkdoc opt">) {</span>
	<span class="function"><a href="https://developer.gnome.org/glib/unstable/glib-The-Main-Event-Loop.html#g-timeout-add-seconds">g_timeout_add_seconds</a></span> <span class="gtkdoc opt">(</span><span class="number">20</span><span class="gtkdoc opt">,</span> cursor_data_source_timeout<span class="gtkdoc opt">,</span> NULL<span class="gtkdoc opt">);</span>
	<span class="function"><a href="https://developer.gnome.org/glib/unstable/glib-The-Main-Event-Loop.html#g-main-loop-run">g_main_loop_run</a></span> <span class="gtkdoc opt">(</span>loop<span class="gtkdoc opt">);</span>

	<span class="comment">/* By now we aborted or we have an addressbook created */</span>
	<span class="function"><a href="https://developer.gnome.org/glib/unstable/glib-Testing.html#g-assert">g_assert</a></span> <span class="gtkdoc opt">(</span>address_book <span class="gtkdoc opt">!=</span> NULL<span class="gtkdoc opt">);</span>
<span class="gtkdoc opt">}</span>

<span class="comment">/**********************************************************</span>
<span class="comment"> * Ok, done with creating an addressbook, let's add data  *</span>
<span class="comment"> **********************************************************/</span>
<span class="function">load_contacts</span> <span class="gtkdoc opt">(</span>address_book<span class="gtkdoc opt">,</span> vcard_path<span class="gtkdoc opt">);</span>

<span class="comment">/* Addressbook should have contacts now, let's create the cursor */</span>
<span class="gtkdoc opt">*</span>ret_cursor <span class="gtkdoc opt">=</span> <span class="function">get_cursor</span> <span class="gtkdoc opt">(</span>address_book<span class="gtkdoc opt">);</span>

<span class="comment">/* Cleanup some resources we used to populate the addressbook */</span>
<span class="function"><a href="https://developer.gnome.org/glib/unstable/glib-The-Main-Event-Loop.html#g-main-loop-unref">g_main_loop_unref</a></span> <span class="gtkdoc opt">(</span>loop<span class="gtkdoc opt">);</span>
<span class="function"><a href="https://developer.gnome.org/gobject/unstable/gobject-The-Base-Object-Type.html#g-object-unref">g_object_unref</a></span> <span class="gtkdoc opt">(</span>address_book_source<span class="gtkdoc opt">);</span>
<span class="function"><a href="https://developer.gnome.org/gobject/unstable/gobject-The-Base-Object-Type.html#g-object-unref">g_object_unref</a></span> <span class="gtkdoc opt">(</span>registry<span class="gtkdoc opt">);</span>

<span class="comment">/* Give the ref through the return value*/</span>
ret_book <span class="gtkdoc opt">=</span> address_book<span class="gtkdoc opt">;</span>

address_book_source <span class="gtkdoc opt">=</span> NULL<span class="gtkdoc opt">;</span>
address_book <span class="gtkdoc opt">=</span> NULL<span class="gtkdoc opt">;</span>

<span class="comment">/* Return the addressbook */</span>
<span class="keyword">return</span> ret_book<span class="gtkdoc opt">;</span>
<span class="gtkdoc opt">}</span></pre></td>
      </tr>
    </tbody>
  </table>
</div>

</div>
</div>
<div class="footer">
<hr>
          Generated by GTK-Doc V1.21</div>
</body>
</html>