From ebb8a861406825a27ef3f8f09039455bdbe7ca9e Mon Sep 17 00:00:00 2001
From: David Woodhouse <David.Woodhouse@intel.com>
Date: Mon, 20 Sep 2010 13:30:13 +0100
Subject: [PATCH 3/6] Bug 630150 - imapx attempts to connect to server when already cancelled

---
 camel/providers/imapx/camel-imapx-store.c |    5 +++++
 1 files changed, 5 insertions(+), 0 deletions(-)

diff --git a/camel/providers/imapx/camel-imapx-store.c b/camel/providers/imapx/camel-imapx-store.c
index 79567ea..1fd4148 100644
--- a/camel/providers/imapx/camel-imapx-store.c
+++ b/camel/providers/imapx/camel-imapx-store.c
@@ -211,6 +211,11 @@ camel_imapx_store_get_server(CamelIMAPXStore *store, CamelException *ex)
 {
 	CamelIMAPXServer *server = NULL;
 
+	if (camel_operation_cancel_check(NULL)) {
+		camel_exception_set (ex, CAMEL_EXCEPTION_USER_CANCEL,
+				     _("Cancelled"));
+		return NULL;
+	}
 	CAMEL_SERVICE_REC_LOCK (store, connect_lock);
 
 	if (store->server && camel_imapx_server_connect(store->server, ex)) {
-- 
1.7.1

